{"1763732662494":{"actionType":"saveAll","createdAt":"1763732662494","actionID":"1763732662494","userID":"#TEMP","path":"system.capsules.ae079527-4d70-4026-9808-5b37304d8144.capsUseCodeInfo.capsUseDescription.en","oldValue":"(txt) => {\n  console.log(\"Digitado:\", txt);\n\n\n  // Remove tudo que não for número\n  let v = txt.replace(/\\D/g, \"\");\n\n  // Aplica a formatação DD/MM/AAAA\n  if (v.length > 2 && v.length <= 4) {\n    v = v.replace(/(\\d{2})(\\d{1,2})/, \"$1/$2\");\n  } else if (v.length > 4) {\n    v = v.replace(/(\\d{2})(\\d{2})(\\d{1,4})/, \"$1/$2/$3\");\n  }\n\n  // Limita a 10 caracteres\n  v = v.substring(0, 10);\n\n  console.log(\"Formatado:\", v);\n\n  // Atualiza o valor formatado no CT\n  tools.setData({\n    path: \"sc.a1.iptChanges.startDate\",\n    value: v\n  });\n\n  // Retorna o valor formatado, caso o componente aceite retorno\n  return v;\n}","newValue":"(txt) => {\n  try {\n    if (typeof txt !== \"string\") txt = String(txt ?? \"\");\n\n    // Mantém apenas números (sem regex)\n    let clean = \"\";\n    for (let i = 0; i < txt.length; i++) {\n      const ch = txt[i];\n      if (ch >= \"0\" && ch <= \"9\") {\n        clean += ch;\n      }\n    }\n\n    // Limita a 8 dígitos (ddmmyyyy)\n    if (clean.length > 8) clean = clean.slice(0, 8);\n\n    console.log({ clean });\n\n    // Monta máscara dd/mm/aaaa\n    let masked = \"\";\n    if (clean.length > 0) masked = clean.slice(0, 2);         // dd\n    if (clean.length >= 3) masked += \"/\" + clean.slice(2, 4); // dd/mm\n    if (clean.length >= 5) masked += \"/\" + clean.slice(4, 8); // dd/mm/aaaa\n\n    console.log({ masked });\n\n    tools.functions.setVar({\n      args: \"\",\n      pass: {\n        keyPath: [\"sc.a1.iptChanges.endDate\"],\n        value: [String(masked)],\n      },\n    });\n  } catch (e) {\n    console.error(\"Erro na máscara de data:\", e);\n    return txt;\n  }\n}"}}