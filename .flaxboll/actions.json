{"1764261196521":{"actionType":"saveAll","createdAt":"1764261196521","actionID":"1764261196521","userID":"#TEMP","path":"system.capsules.cbebb8de-295b-4ddf-816b-5910b42d57de.capsUseCodeInfo.capsUseInputs.sss_custom_caps-0.capsIptTxtValue","oldValue":"async () => {\n  const css1 =\n    \"color: limegreen; background-color: darkcyan; font-size: 11px; padding: 2px 6px; border-radius: 3px\";\n\n  const { getFirestore, doc, updateDoc } = await import(\"firebase/firestore\");\n\n  const fbInit = tools.getCtData(\"all.temp.fireInit\");\n  const db = getFirestore(fbInit);\n\n  const c8Data = tools.getCtData(\"sc.C8.profiles.profileData1\");\n\n  const lotId = tools.getCtData(\"sc.C7.currents.currLoteData\") || \"\";\n  const installmentId = c8Data.installmentId || \"\";\n\n  const documents = tools.getCtData(\"sc.C8.forms.editChanges.arrDocuments\");\n  console.log(\"%cdocuments\", css1, { documents });\n  console.log(\"%clotId\", css1, { lotId });\n\n  const data = {\n    installmentId,\n    date: c8Data.date || \"\",\n    receiptUrl: documents[0] || \"\",\n  };\n\n  console.log(\"%cdata\", css1, { data });\n\n  try {\n    const refDoc = doc(db, \"lots\", lotId);\n    console.log(\"%crefDoc\", css1, { refDoc });\n\n    const dataToUpdate = {\n      [\"receipts.\" + installmentId]: { ...data },\n    };\n\n    console.log(\"%cdataToUpdate\", css1, { dataToUpdate });\n\n    await updateDoc(refDoc, dataToUpdate);\n\n    // ------ set ctData\n    console.log(\"%cUpdateOk\", css1);\n    tools.setData({ path: \"sc.C8.forms.editChanges\", value: {} });\n    tools.setData({ path: \"sc.C8.profiles.profileData1\", value: {} });\n\n    console.log(\"%cupdateDoc ok\", css1);\n    console.log(\"%cReferência do Documento\", css1, {\n      path: \"lots.\" + installmentId,\n      dataToUpdate,\n    });\n\n    tools.goTo(\"c7financial\");\n  } catch (err) {\n    console.error(\"Erro do updateDoc C8\", { err });\n  }\n}","newValue":"async () => {\n  const css1 =\n    \"color: limegreen; background-color: darkcyan; font-size: 11px; padding: 2px 6px; border-radius: 3px\";\n\n  const { getFirestore, doc, updateDoc } = await import(\"firebase/firestore\");\n\n  const fbInit = tools.getCtData(\"all.temp.fireInit\");\n  const db = getFirestore(fbInit);\n\n  const c8Data = tools.getCtData(\"sc.C8.profiles.profileData1\");\n\n  const lotData = tools.getCtData(\"sc.C7.currents.currLoteData\");\n  const installmentId = c8Data.installmentId || \"\";\n  const lotId = lotData.lotId || \"\";\n\n  const documents = tools.getCtData(\"sc.C8.forms.editChanges.arrDocuments\");\n  console.log(\"%cdocuments\", css1, { documents });\n  console.log(\"%clotId\", css1, { lotId });\n\n  const data = {\n    installmentId,\n    date: c8Data.date || \"\",\n    receiptUrl: documents[0] || \"\",\n  };\n\n  console.log(\"%cdata\", css1, { data });\n\n  try {\n    const refDoc = doc(db, \"lots\", lotId);\n    console.log(\"%crefDoc\", css1, { refDoc });\n\n    const dataToUpdate = {\n      [\"receipts.\" + installmentId]: { ...data },\n    };\n\n    console.log(\"%cdataToUpdate\", css1, { dataToUpdate });\n\n    await updateDoc(refDoc, dataToUpdate);\n\n    // ------ set ctData\n    console.log(\"%cUpdateOk\", css1);\n    tools.setData({ path: \"sc.C8.forms.editChanges\", value: {} });\n    tools.setData({ path: \"sc.C8.profiles.profileData1\", value: {} });\n\n    console.log(\"%cupdateDoc ok\", css1);\n    console.log(\"%cReferência do Documento\", css1, {\n      path: \"lots.\" + installmentId,\n      dataToUpdate,\n    });\n\n    tools.goTo(\"c7financial\");\n  } catch (err) {\n    console.error(\"Erro do updateDoc C8\", { err });\n  }\n}"}}