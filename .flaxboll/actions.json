{"1763986750594":{"actionType":"saveAll","createdAt":"1763986750594","actionID":"1763986750594","userID":"#TEMP","path":"system.capsules.43973839-5c38-421f-bb38-e63d16600e01.capsUseCodeInfo.capsUseInputs.sss_custom_caps-0.capsIptTxtValue","oldValue":"async () => {\n  try {\n    const { \n      getFirestore, \n      collection, \n      getDocs, \n      query, \n      where \n    } = await import(\"firebase/firestore\");\n\n    const fbInit = tools.getCtData(\"all.temp.fireInit\");\n    const db = getFirestore(fbInit);\n\n    // Dados do usu√°rio autenticado\n    const typeAccount = tools.getCtData(\"all.authUser.typeAccount\");\n    const condoId = tools.getCtData(\"all.authUser.condoId\");\n    const userDocId = tools.getCtData(\"all.authUser.docId\");\n\n    console.log(\"Usu√°rio logado:\", { typeAccount, condoId, userDocId });\n\n    const refCondos = collection(db, \"condos\");\n    let snapshot;\n\n    // ---------------------------------------------------------\n    // 1Ô∏è‚É£ Se for ADMIN ‚Üí traz todos os condom√≠nios\n    // ---------------------------------------------------------\n    if (typeAccount === \"adm\") {\n      console.log(\"Conta ADM ‚Üí buscando TODOS os condom√≠nios...\");\n      snapshot = await getDocs(refCondos);\n    }\n\n    // ---------------------------------------------------------\n    // 2Ô∏è‚É£ Se for PARTNER ‚Üí filtra pelo condoId desse usu√°rio\n    // ---------------------------------------------------------\n    else if (typeAccount === \"partner\") {\n      if (!condoId) {\n        console.warn(\"Usu√°rio parceiro sem condoId definido!\");\n        return;\n      }\n\n      console.log(\"Conta PARTNER ‚Üí buscando S√ì o condom√≠nio permitido...\");\n\n      const q = query(refCondos, where(\"__name__\", \"==\", condoId));\n      snapshot = await getDocs(q);\n    }\n\n    // ---------------------------------------------------------\n    // 3Ô∏è‚É£ Se tipo de conta for outro ‚Üí evita crash\n    // ---------------------------------------------------------\n    else {\n      console.warn(\"Tipo de conta n√£o reconhecido:\", typeAccount);\n      return;\n    }\n\n    // ---------------------------------------------------------\n    // Converte os documentos para array utiliz√°vel na UI\n    // ---------------------------------------------------------\n    const condosList = [];\n    snapshot.forEach((doc) => {\n      condosList.push({\n        id: doc.id,\n        ...doc.data()\n      });\n    });\n\n    console.log(\"Lista final de condom√≠nios:\", condosList);\n\n    // Salva na tela (ex.: sc.condos.list)\n    tools.setData({\n      path: \"sc.a7.list\",\n      value: condosList,\n    });\n  } catch (err) {\n    console.error(\"Erro ao carregar lista de condom√≠nios:\", err);\n  }\n}","newValue":"async () => {\n  try {\n    const { \n      getFirestore, \n      collection, \n      getDocs, \n      query, \n      where \n    } = await import(\"firebase/firestore\");\n\n    const fbInit = tools.getCtData(\"all.temp.fireInit\");\n    const db = getFirestore(fbInit);\n\n    // Dados do usu√°rio autenticado\n    const typeAccount = tools.getCtData(\"all.authUser.typeAccount\");\n    const condoId = tools.getCtData(\"all.authUser.condoId\");\n    const userDocId = tools.getCtData(\"all.authUser.docId\");\n\n    // üî• Log copi√°vel\n    console.log(\n      \"DEBUG USER DATA => \" +\n        JSON.stringify(\n          { typeAccount, condoId, userDocId },\n          null,\n          2\n        )\n    );\n\n    const refCondos = collection(db, \"condos\");\n    let snapshot;\n\n    // ---------------------------------------------------------\n    // 1Ô∏è‚É£ Se for ADMIN ‚Üí traz todos os condom√≠nios\n    // ---------------------------------------------------------\n    if (typeAccount === \"adm\") {\n      console.log(\"Conta ADM ‚Üí buscando TODOS os condom√≠nios...\");\n      snapshot = await getDocs(refCondos);\n    }\n\n    // ---------------------------------------------------------\n    // 2Ô∏è‚É£ Se for PARTNER ‚Üí filtra pelo condoId desse usu√°rio\n    // ---------------------------------------------------------\n    else if (typeAccount === \"partner\") {\n      if (!condoId) {\n        console.warn(\"Usu√°rio parceiro sem condoId definido!\");\n        return;\n      }\n\n      console.log(\"Conta PARTNER ‚Üí buscando S√ì o condom√≠nio permitido...\");\n\n      const q = query(refCondos, where(\"__name__\", \"==\", condoId));\n      snapshot = await getDocs(q);\n    }\n\n    // ---------------------------------------------------------\n    // 3Ô∏è‚É£ Se tipo de conta for outro ‚Üí evita crash\n    // ---------------------------------------------------------\n    else {\n      console.warn(\"Tipo de conta n√£o reconhecido:\", typeAccount);\n      return;\n    }\n\n    // ---------------------------------------------------------\n    // Converte os documentos para array utiliz√°vel na UI\n    // ---------------------------------------------------------\n    const condosList = [];\n    snapshot.forEach((doc) => {\n      condosList.push({\n        id: doc.id,\n        ...doc.data()\n      });\n    });\n\n    console.log(\"Lista final de condom√≠nios:\", condosList);\n\n    // Salva na tela (ex.: sc.condos.list)\n    tools.setData({\n      path: \"sc.a7.list\",\n      value: condosList,\n    });\n  } catch (err) {\n    console.error(\"Erro ao carregar lista de condom√≠nios:\", err);\n  }\n}"}}