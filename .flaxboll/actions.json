{"1764880149674":{"actionType":"saveAll","createdAt":"1764880149674","actionID":"1764880149674","userID":"#TEMP","path":"system.capsules.9f52a195-fa67-46f1-9faa-972749b0c48a.capsUseCodeInfo.capsUseInputs.sss_custom_caps-0.capsIptTxtValue","oldValue":"(args) => {\n  const parseBRDate = (str: string) => {\n    if (typeof str !== \"string\") return 0;\n    const [d, m, y] = str.split(\"/\").map(Number);\n    if (!d || !m || !y) return 0;\n    return new Date(y, m - 1, d).getTime();\n  };\n\n  console.log(\"Dados do Lote\", { args });\n\n  const objLote = args[0];\n\n  if (typeof objLote !== \"object\" || objLote === null) {\n    console.log(\"âŒ lote invÃ¡lido:\", objLote);\n    return;\n  }\n\n  const installments = objLote?.installments ?? {};\n  const newArray: any[] = Object.values(installments) ?? [];\n\n  const numberOfInstallments = objLote.numberOfInstallments;\n\n  let finalArray =\n    newArray.length > 0\n      ? newArray.map((item, index) => {\n          const count = index + 1;\n          return {\n            ...item,\n            formatedInstallments: count + \"/\" + numberOfInstallments,\n          };\n        })\n      : [];\n\n  console.log(\"Array Final (antes ordenar):\", finalArray);\n\n  // ================================\n  // ðŸ”¥ ORDENAR POR DATA (dd/mm/aaaa)\n  // ================================\n  finalArray = finalArray.sort((a, b) => {\n    const da = parseBRDate(a?.date);\n    const db = parseBRDate(b?.date);\n    return db - db;\n  });\n\n  console.log(\"Array Final (ordenado):\", finalArray);\n\n  tools.setData({ path: \"sc.C7.lists.list1\", value: finalArray });\n  tools.setData({ path: \"sc.C7.currents.currLoteData\", value: objLote });\n}","newValue":"(args) => {\n  const parseBRDate = (str: string) => {\n    if (typeof str !== \"string\") return 0;\n    const [d, m, y] = str.split(\"/\").map(Number);\n    if (!d || !m || !y) return 0;\n    return new Date(y, m - 1, d).getTime();\n  };\n\n  console.log(\"Dados do Lote\", { args });\n\n  const objLote = args[0];\n\n  if (typeof objLote !== \"object\" || objLote === null) {\n    console.log(\"âŒ lote invÃ¡lido:\", objLote);\n    return;\n  }\n\n  const installments = objLote?.installments ?? {};\n  const newArray: any[] = Object.values(installments) ?? [];\n\n  const numberOfInstallments = objLote.numberOfInstallments;\n\n  let finalArray =\n    newArray.length > 0\n      ? newArray.map((item, index) => {\n          const count = index + 1;\n          return {\n            ...item,\n            formatedInstallments: count + \"/\" + numberOfInstallments,\n          };\n        })\n      : [];\n\n  console.log(\"Array Final (antes ordenar):\", finalArray);\n\n  // ================================\n  // ðŸ”¥ ORDENAR POR DATA (dd/mm/aaaa)\n  // ================================\n  finalArray = finalArray.sort((a, b) => {\n    const da = parseBRDate(a?.date);\n    const db = parseBRDate(b?.date);\n    return db - da;\n  });\n\n  console.log(\"Array Final (ordenado):\", finalArray);\n\n  tools.setData({ path: \"sc.C7.lists.list1\", value: finalArray });\n  tools.setData({ path: \"sc.C7.currents.currLoteData\", value: objLote });\n}"}}