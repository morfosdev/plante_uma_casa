{"1765212665553":{"actionType":"saveAll","createdAt":"1765212665553","actionID":"1765212665553","userID":"#TEMP","path":"system.capsules.4bfb5273-e682-452d-9c46-7dc8d1b2ac76.capsUseCodeInfo.capsUseInputs.sss_custom_caps_el-0.capsIptTxtValue","oldValue":"() => {\n  const arrDocuments =\n    useData((ct) => ct.sc?.C6?.forms?.editChanges?.arrDocuments) ?? [];\n\n  // const { width } = RN.useWindowDimensions();\n  // const isSmall = width < 200;\n\n  const styles = RN.StyleSheet.create({\n    container: {\n      flexDirection: \"row\",\n      flexWrap: \"wrap\",\n      justifyContent: \"space-between\",\n      paddingLeft: 16,\n      paddingRight: 16,\n    },\n    doc: {\n      width: \"100%\",\n      height: 35,\n      borderRadius: 8,\n      marginBottom: 10,\n      borderWidth: 1,\n      borderColor: \"#ccc\",\n      alignItems: \"center\",\n      padding: 8,\n    },\n    txt: {\n      fontSize: 12,\n      color: \"#666\",\n    },\n  });\n\n  return (\n    <RN.ScrollView contentContainerStyle={styles.container}>\n      {arrDocuments.map((item, idx) => (\n        <RN.View key={idx} style={styles.doc}>\n          <RN.Text style={styles.txt}>{item.fileName}</RN.Text>\n        </RN.View>\n      ))}\n    </RN.ScrollView>\n  );\n}","newValue":"() => {\n  const arrDocuments =\n    useData((ct) => ct.sc?.C6?.forms?.editChanges?.arrDocuments) ?? [];\n\n  const styles = RN.StyleSheet.create({\n    container: {\n      flexDirection: \"row\",\n      flexWrap: \"wrap\",\n      justifyContent: \"space-between\",\n      paddingLeft: 16,\n      paddingRight: 16,\n    },\n    doc: {\n      width: \"100%\",\n      height: 35,\n      borderRadius: 8,\n      marginBottom: 10,\n      borderWidth: 1,\n      borderColor: \"#ccc\",\n      alignItems: \"center\",\n      padding: 8,\n    },\n    txt: {\n      fontSize: 12,\n      color: \"#666\",\n    },\n  });\n\n  // ---------------------------------------------------------\n  // --------- DOWNLOAD NATIVO (PDF, DOC, ZIP etc.) ----------\n  // ---------------------------------------------------------\n  const handleDownloadNative = async (url: string, fileName?: string) => {\n    try {\n      if (!url) {\n        RN.Alert.alert(\"Arquivo inválido\", \"URL não encontrada.\");\n        return;\n      }\n\n      const { name } = resolveDocFileName(url, fileName);\n      const baseDir = FileSystem.documentDirectory + \"downloads_docs/\";\n\n      // cria pasta se não existir\n      const dirInfo = await FileSystem.getInfoAsync(baseDir);\n      if (!dirInfo.exists) {\n        await FileSystem.makeDirectoryAsync(baseDir, { intermediates: true });\n      }\n\n      const fileUri = baseDir + name;\n\n      const result = await FileSystem.downloadAsync(url, fileUri);\n      console.log(\"Download concluído:\", result.uri);\n\n      // abre share sheet (PDF, DOC, XLS etc.)\n      if (await Sharing.isAvailableAsync()) {\n        await Sharing.shareAsync(result.uri);\n      } else {\n        RN.Alert.alert(\"Download concluído\", result.uri);\n      }\n\n    } catch (err) {\n      console.log(\"Erro download:\", err);\n      RN.Alert.alert(\"Erro\", \"Não foi possível baixar o documento.\");\n    }\n  };\n\n  // ---------------------------------------------------------\n  // -------------------- DOWNLOAD WEB -----------------------\n  // ---------------------------------------------------------\n  const handleDownloadWeb = async (url: string, fileName?: string) => {\n    if (!url) return;\n\n    const { name } = resolveDocFileName(url, fileName);\n\n    try {\n      const resp = await fetch(url);\n      const blob = await resp.blob();\n      const blobUrl = URL.createObjectURL(blob);\n\n      const link = document.createElement(\"a\");\n      link.href = blobUrl;\n      link.download = name;\n\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n\n      URL.revokeObjectURL(blobUrl);\n    } catch (e) {\n      console.log(\"Erro web:\", e);\n    }\n  };\n\n  // ------------------- Handler único -----------------------\n  const handlePress = (item: any) => {\n    const url = item?.fileUrl || item?.receiptUrl;\n    const name = item?.fileName;\n\n    if (!url) return;\n\n    if (RN.Platform.OS === \"web\") {\n      handleDownloadWeb(url, name);\n    } else {\n      handleDownloadNative(url, name);\n    }\n  };\n\n  // ---------------------- Render ---------------------------\n  return (\n    <RN.ScrollView contentContainerStyle={styles.container}>\n      {arrDocuments.map((item: any, idx: number) => (\n        <RN.Pressable key={idx} style={styles.doc} onPress={() => handlePress(item)}>\n          <RN.Text style={styles.txt}>{item.fileName}</RN.Text>\n        </RN.Pressable>\n      ))}\n    </RN.ScrollView>\n  );\n}"}}