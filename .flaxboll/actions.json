{"1764611698495":{"actionType":"saveAll","createdAt":"1764611698495","actionID":"1764611698495","userID":"#TEMP","path":"system.capsules.ee207416-dd0d-47f1-99b2-23c8123a7702.capsUseCodeInfo.capsUseInputs.sss_custom_caps-0.capsIptTxtValue","oldValue":"async () => {\n  console.log(\"üîç Iniciando busca de lote e condom√≠nio...\");\n\n  // --- inicializar firebase ----\n  const { initializeApp, getApps } = await import(\"firebase/app\");\n  const { getFirestore, doc, getDoc } = await import(\"firebase/firestore\");\n\n  if (getApps().length === 0) {\n    console.log(\"‚öôÔ∏è Inicializando Firebase...\");\n    initializeApp({\n      apiKey: tools.getEnv(\"apiKey\"),\n      authDomain: tools.getEnv(\"authDomain\"),\n      projectId: tools.getEnv(\"projectId\"),\n      storageBucket: tools.getEnv(\"storageBucket\"),\n      messagingSenderId: tools.getEnv(\"messagingSenderId\"),\n      appId: tools.getEnv(\"appId\"),\n    });\n  } else {\n    console.log(\"‚úî Firebase j√° estava inicializado.\");\n  }\n\n  const db = getFirestore();\n\n  // --- 1. BUSCA O LOTE ---\n  const lotId = tools.getCtData(\"all.authUser.lotId\");\n\n  if (!lotId) {\n    console.log(\"‚ùå Usu√°rio n√£o tem lotId\");\n    return;\n  }\n\n  console.log(\"üìå Buscando lote:\", lotId);\n\n  const lotRef = doc(db, \"lots\", lotId);\n  const lotSnap = await getDoc(lotRef);\n\n  if (!lotSnap.exists()) {\n    console.log(\"‚ùå Lote n√£o encontrado.\");\n    return;\n  }\n\n  const lotData = { docId: lotSnap.id, ...lotSnap.data() };\n  console.log(\"üì¶ Lote encontrado:\", lotData);\n\n  tools.setData({\n    path: \"sc.C5.currents.lotData\",\n    value: [lotData],\n  });\n\n  // --- 2. BUSCA O CONDOM√çNIO ---\n  const condoId = lotData.condoId;\n\n  if (!condoId) {\n    console.log(\"‚ùå Lote n√£o tem condoId\");\n    return;\n  }\n\n  console.log(\"üìå Buscando condom√≠nio:\", condoId);\n\n  const condoRef = doc(db, \"condos\", condoId);\n  const condoSnap = await getDoc(condoRef);\n\n  if (!condoSnap.exists()) {\n    console.log(\"‚ùå Condom√≠nio n√£o encontrado.\");\n    return;\n  }\n\n  const condoData = { docId: condoSnap.id, ...condoSnap.data() };\n  console.log(\"üè¢ Condom√≠nio encontrado:\", condoData);\n\n  tools.setData({\n    path: \"sc.C5.currents.condoData\",\n    value: [condoData],\n  });\n\n  console.log(\"‚úÖ Finalizado com sucesso!\");\n};\n","newValue":"async () => {\n  console.log(\"üîç Iniciando busca de lote e condom√≠nio...\");\n\n  // --- inicializar firebase ----\n  const { initializeApp, getApps } = await import(\"firebase/app\");\n  const { getFirestore, doc, getDoc } = await import(\"firebase/firestore\");\n\n  if (getApps().length === 0) {\n    console.log(\"‚öôÔ∏è Inicializando Firebase...\");\n    initializeApp({\n      apiKey: tools.getEnv(\"apiKey\"),\n      authDomain: tools.getEnv(\"authDomain\"),\n      projectId: tools.getEnv(\"projectId\"),\n      storageBucket: tools.getEnv(\"storageBucket\"),\n      messagingSenderId: tools.getEnv(\"messagingSenderId\"),\n      appId: tools.getEnv(\"appId\"),\n    });\n  } else {\n    console.log(\"‚úî Firebase j√° estava inicializado.\");\n  }\n\n  const db = getFirestore();\n\n  // --- 1. BUSCA O LOTE ---\n  const lotId = tools.getCtData(\"all.authUser.lotId\");\n\n  if (!lotId) {\n    console.log(\"‚ùå Usu√°rio n√£o tem lotId\");\n    return;\n  }\n\n  console.log(\"üìå Buscando lote:\", lotId);\n\n  const lotRef = doc(db, \"lots\", lotId);\n  const lotSnap = await getDoc(lotRef);\n\n  if (!lotSnap.exists()) {\n    console.log(\"‚ùå Lote n√£o encontrado.\");\n    return;\n  }\n\n  const lotData = { docId: lotSnap.id, ...lotSnap.data() };\n  console.log(\"üì¶ Lote encontrado:\", lotData);\n\n  tools.setData({\n    path: \"sc.C5.currents.lotData\",\n    value: [lotData],\n  });\n\n  // --- 2. BUSCA O CONDOM√çNIO ---\n  const condoId = lotData.condoId;\n\n  if (!condoId) {\n    console.log(\"‚ùå Lote n√£o tem condoId\");\n    return;\n  }\n\n  console.log(\"üìå Buscando condom√≠nio:\", condoId);\n\n  const condoRef = doc(db, \"condos\", condoId);\n  const condoSnap = await getDoc(condoRef);\n\n  if (!condoSnap.exists()) {\n    console.log(\"‚ùå Condom√≠nio n√£o encontrado.\");\n    return;\n  }\n\n  const condoData = { docId: condoSnap.id, ...condoSnap.data() };\n  console.log(\"üè¢ Condom√≠nio encontrado:\", condoData);\n\n  tools.setData({\n    path: \"sc.C5.currents.condoData\",\n    value: [condoData],\n  });\n\n  console.log(\"‚úÖ Finalizado com sucesso!\");\n}"}}