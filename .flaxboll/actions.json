{"1763986075842":{"actionType":"saveAll","createdAt":"1763986075842","actionID":"1763986075842","userID":"#TEMP","path":"system.capsules.43973839-5c38-421f-bb38-e63d16600e01.capsUseCodeInfo.capsUseInputs.sss_custom_caps-0.capsIptTxtValue","oldValue":"async () => {\n  try {\n    const { \n      getFirestore, \n      collection, \n      getDocs, \n      query, \n      where \n    } = await import(\"firebase/firestore\");\n\n    const fbInit = tools.getCtData(\"all.temp.fireInit\");\n    const db = getFirestore(fbInit);\n\n    // Dados do usuário autenticado\n    const typeAccount = tools.getCtData(\"all.authUser.typeAccount\");\n    const condoId = tools.getCtData(\"all.authUser.condoId\");\n    const userDocId = tools.getCtData(\"all.authUser.docId\");\n\n    console.log(\"Usuário logado:\", { typeAccount, condoId, userDocId });\n\n    const refCondos = collection(db, \"condos\");\n    let snapshot;\n\n    // ---------------------------------------------------------\n    // 1️⃣ Se for ADMIN → traz todos os condomínios\n    // ---------------------------------------------------------\n    if (typeAccount === \"adm\") {\n      console.log(\"Conta ADM → buscando TODOS os condomínios...\");\n      snapshot = await getDocs(refCondos);\n    }\n\n    // ---------------------------------------------------------\n    // 2️⃣ Se for PARTNER → filtra pelo condoId desse usuário\n    // ---------------------------------------------------------\n    else if (typeAccount === \"partner\") {\n      if (!condoId) {\n        console.warn(\"Usuário parceiro sem condoId definido!\");\n        return;\n      }\n\n      console.log(\"Conta PARTNER → buscando SÓ o condomínio permitido...\");\n\n      const q = query(refCondos, where(\"__name__\", \"==\", condoId));\n      snapshot = await getDocs(q);\n    }\n\n    // ---------------------------------------------------------\n    // 3️⃣ Se tipo de conta for outro → evita crash\n    // ---------------------------------------------------------\n    else {\n      console.warn(\"Tipo de conta não reconhecido:\", typeAccount);\n      return;\n    }\n\n    // ---------------------------------------------------------\n    // Converte os documentos para array utilizável na UI\n    // ---------------------------------------------------------\n    const condosList = [];\n    snapshot.forEach((doc) => {\n      condosList.push({\n        id: doc.id,\n        ...doc.data()\n      });\n    });\n\n    console.log(\"Lista final de condomínios:\", condosList);\n\n    // Salva na tela (ex.: sc.condos.list)\n    tools.setData({\n      path: \"sc.a7.list\",\n      value: condosList,\n    });\n  } catch (err) {\n    console.error(\"Erro ao carregar lista de condomínios:\", err);\n  }\n};\n","newValue":"async () => {\n  try {\n    const { \n      getFirestore, \n      collection, \n      getDocs, \n      query, \n      where \n    } = await import(\"firebase/firestore\");\n\n    const fbInit = tools.getCtData(\"all.temp.fireInit\");\n    const db = getFirestore(fbInit);\n\n    // Dados do usuário autenticado\n    const typeAccount = tools.getCtData(\"all.authUser.typeAccount\");\n    const condoId = tools.getCtData(\"all.authUser.condoId\");\n    const userDocId = tools.getCtData(\"all.authUser.docId\");\n\n    console.log(\"Usuário logado:\", { typeAccount, condoId, userDocId });\n\n    const refCondos = collection(db, \"condos\");\n    let snapshot;\n\n    // ---------------------------------------------------------\n    // 1️⃣ Se for ADMIN → traz todos os condomínios\n    // ---------------------------------------------------------\n    if (typeAccount === \"adm\") {\n      console.log(\"Conta ADM → buscando TODOS os condomínios...\");\n      snapshot = await getDocs(refCondos);\n    }\n\n    // ---------------------------------------------------------\n    // 2️⃣ Se for PARTNER → filtra pelo condoId desse usuário\n    // ---------------------------------------------------------\n    else if (typeAccount === \"partner\") {\n      if (!condoId) {\n        console.warn(\"Usuário parceiro sem condoId definido!\");\n        return;\n      }\n\n      console.log(\"Conta PARTNER → buscando SÓ o condomínio permitido...\");\n\n      const q = query(refCondos, where(\"__name__\", \"==\", condoId));\n      snapshot = await getDocs(q);\n    }\n\n    // ---------------------------------------------------------\n    // 3️⃣ Se tipo de conta for outro → evita crash\n    // ---------------------------------------------------------\n    else {\n      console.warn(\"Tipo de conta não reconhecido:\", typeAccount);\n      return;\n    }\n\n    // ---------------------------------------------------------\n    // Converte os documentos para array utilizável na UI\n    // ---------------------------------------------------------\n    const condosList = [];\n    snapshot.forEach((doc) => {\n      condosList.push({\n        id: doc.id,\n        ...doc.data()\n      });\n    });\n\n    console.log(\"Lista final de condomínios:\", condosList);\n\n    // Salva na tela (ex.: sc.condos.list)\n    tools.setData({\n      path: \"sc.a7.list\",\n      value: condosList,\n    });\n  } catch (err) {\n    console.error(\"Erro ao carregar lista de condomínios:\", err);\n  }\n}"}}