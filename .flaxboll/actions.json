{"1759171646374":{"actionType":"saveAll","createdAt":"1759171646374","actionID":"1759171646374","userID":"#TEMP","path":"system.capsules.268c4fa7-54ea-492e-8f9a-42dddca4d4d6.capsUseCodeInfo.capsUseInputs.sss_freeValue-0.capsIptTxtValue","oldValue":"import React from 'react';\nimport JSON5 from 'json5';\nimport { Pressable, View } from 'react-native';\n\nexport const Accordion = props => {\n  const { configs, arrElements } = props.pass ?? {};\n\n  // parse seguro para aceitar string/objeto/array\n  const safeParse = v => {\n    if (!v) return {};\n    if (typeof v === 'string') {\n      try { return JSON5.parse(v) || {}; } catch { return {}; }\n    }\n    return typeof v === 'object' ? (v || {}) : {};\n  };\n\n  const cfg0 = Array.isArray(configs) ? safeParse(configs[0]) : safeParse(configs);\n  const items = Array.isArray(arrElements) ? arrElements : [];\n\n  const clamp = (n, min, max) => Math.max(min, Math.min(max, n));\n\n  const [openIdx, setOpenIdx] = React.useState(() => {\n    if (!items.length) return null;\n    // Se quiser começar sem nenhum aberto, troque o \"0\" por null\n    let idx = Number.isInteger(cfg0?.defaultOpenIdx) ? cfg0.defaultOpenIdx : 0;\n    if (idx == null) return null;\n    return clamp(idx, 0, items.length - 1);\n  });\n\n  const handleToggle = idx => {\n    setOpenIdx(prev => (prev === idx ? null : idx));\n  };\n\n  console.log('Accordion', { props, openIdx, cfg0 });\n\n  return (\n    <>\n      {items.map((Item, idx) => {\n        const isOpen = openIdx === idx;\n        const child = typeof Item === 'function' ? Item() : Item; // compatível com Item() ou <Item />\n        return (\n          <ItemAcc key={idx} open={isOpen} onToggle={() => handleToggle(idx)}>\n            {child}\n          </ItemAcc>\n        );\n      })}\n    </>\n  );\n};\n\nconst ItemAcc = props => {\n  const { open, onToggle } = props;\n\n  return (\n    <Pressable onPress={onToggle}>\n      <View\n        style={{\n          backgroundColor: 'red',\n          width: 260,\n          minHeight: 30,\n          height: open ? 'auto' : 30,\n          borderRadius: 10,\n          marginBottom: 14,\n          overflow: 'hidden',\n        }}\n      >\n        {props.children}\n      </View>\n    </Pressable>\n  );\n};\n","newValue":"import React from 'react';\nimport JSON5 from 'json5';\nimport { Pressable, View, Text } from 'react-native';\n\nexport const Accordion = props => {\n  const { configs, arrElements } = props.pass ?? {};\n\n  // parse seguro (string/objeto/array)\n  const safeParse = v => {\n    if (!v) return {};\n    if (typeof v === 'string') {\n      try { return JSON5.parse(v) || {}; } catch { return {}; }\n    }\n    return typeof v === 'object' ? (v || {}) : {};\n  };\n\n  const cfg0 = Array.isArray(configs) ? safeParse(configs[0]) : safeParse(configs);\n  const items = Array.isArray(arrElements) ? arrElements : [];\n\n  const clamp = (n, min, max) => Math.max(min, Math.min(max, n));\n\n  const [openIdx, setOpenIdx] = React.useState(() => {\n    if (!items.length) return null;\n    // troque 0 por null se quiser iniciar fechado quando não vier defaultOpenIdx\n    let idx = Number.isInteger(cfg0?.defaultOpenIdx) ? cfg0.defaultOpenIdx : 0;\n    if (idx == null) return null;\n    return clamp(idx, 0, items.length - 1);\n  });\n\n  const handleToggle = idx => {\n    setOpenIdx(prev => (prev === idx ? null : idx));\n  };\n\n  // Garante que cada entrada vire um React element válido\n  const asChild = (Item, idx) => {\n    try {\n      if (typeof Item === 'function') {\n        const out = Item();\n        if (React.isValidElement(out)) return out;\n        if (typeof out === 'string' || typeof out === 'number') return <Text>{String(out)}</Text>;\n        console.warn('Accordion: função no idx %s não retornou elemento válido.', idx, out);\n        return null;\n      }\n      if (React.isValidElement(Item)) return Item;\n      if (typeof Item === 'string' || typeof Item === 'number') return <Text>{String(Item)}</Text>;\n      console.warn('Accordion: item inválido no idx %s.', idx, Item);\n      return null;\n    } catch (e) {\n      console.error('Accordion: erro ao renderizar item %s ->', idx, e);\n      return null;\n    }\n  };\n\n  console.log('Accordion', { props, openIdx, cfg0 });\n\n  return (\n    <>\n      {items.map((Item, idx) => {\n        const isOpen = openIdx === idx;\n        const child = asChild(Item, idx);\n        if (!child) return null;\n        return (\n          <ItemAcc key={idx} open={isOpen} onToggle={() => handleToggle(idx)}>\n            {child}\n          </ItemAcc>\n        );\n      })}\n    </>\n  );\n};\n\nconst ItemAcc = props => {\n  const { open, onToggle } = props;\n\n  return (\n    <Pressable onPress={onToggle}>\n      <View\n        style={{\n          backgroundColor: 'red',\n          width: 260,\n          minHeight: 30,\n          // Em RN nativo evite 'auto'; usar undefined remove a prop.\n          height: open ? undefined : 30,\n          borderRadius: 10,\n          marginBottom: 14,\n          overflow: 'hidden',\n        }}\n      >\n        {props.children}\n      </View>\n    </Pressable>\n  );\n};\n"}}