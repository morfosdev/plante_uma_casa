{"1761322937912":{"actionType":"saveAll","createdAt":"1761322937912","actionID":"1761322937912","userID":"#TEMP","path":"system.capsules.41dd0306-0742-4d8b-b503-189c65dd59a9","newValue":{"capsDB":{"capsID":"41dd0306-0742-4d8b-b503-189c65dd59a9","capsPrjID":"Ssf3PIVuSttc13QsQfKG","capsUserID":"kLOpIJwqZhrUi5I1qKd1","capsCreatedAt":1761322554756},"capsType":"useCode","capsUseCodeInfo":{"capsCodeID":"ccc_stringValue","capsCodeVersionID":"1","capsUpdatedAt":[1761322554756],"capsUseLabel":{"en":"sc.A7.forms.iptsChanges.lot - Copy"},"capsUseDescription":{"pt-br":"","en":"string value"},"capsUseInputs":{"ccc_stringValue-0":{"capsIptCodeID":"ccc_stringValue-0","capsIptTxtValue":"sc.A7.forms.iptsChanges.lot"}},"capsUseConections":"1","parents":{"conn_1":{"connID":"conn_1","capsParentIptID":"ccc_textInputEdit_C-2","parentData":{"parentConnID":"conn_1","capsParentID":"1867a730-f30b-4722-a6e6-49c551521551"}}}}}},"1761322937913":{"actionType":"saveAll","createdAt":"1761322937913","actionID":"1761322937913","userID":"#TEMP","path":"system.capsules.fc90c336-ef21-4c24-a9b4-9b48689a4633.capsUseCodeInfo.capsUseInputs.sss_custom_caps-0.capsIptTxtValue","oldValue":"async () => {\n  // Lista de campos obrigat√≥rios\n  const requiredFields = [\n    { path: \"sc.A7.forms.iptsChanges.partnerName\", name: \"Nome do Propriet√°rio\" },\n    { path: \"sc.A7.forms.iptsChanges.partnerMail\", name: \"E-mail\" },\n    { path: \"sc.A7.forms.iptsChanges.lot\", name: \"Obra\" },\n    { path: \"sc.A7.forms.iptsChanges.area\", name: \"√Årea\" },\n    { path: \"sc.A7.forms.iptsChanges.totalValue\", name: \"Valor total da obra\" },\n\t\t{ path: \"sc.A7.forms.iptsChanges.firstInstallment\", name: \"Valor total da entrada\" },\n  ];\n\n  // Fun√ß√£o auxiliar para obter valor seguro\n  const getVal = (path) => {\n    const val = tools.getCtData(path);\n    if (Array.isArray(val)) return val[0] ?? \"\";\n    return val ?? \"\";\n  };\n\n  // Checa campos vazios\n  const emptyFields = requiredFields.filter((f) => {\n    const v = getVal(f.path);\n    return v === \"\" || v === null || v === undefined;\n  });\n\n  // Define mensagem e estado final\n  let message = \"\";\n\n  if (emptyFields.length > 0) {\n    message = `Preencha os campos obrigat√≥rios.`;\n\n    tools.functions.setVar({\n      args: \"\",\n      pass: {\n        keyPath: [\"sc.a7.validationMessage\"],\n        value: [message],\n      },\n    });\n\n    console.warn(\"‚ö†Ô∏è Campos vazios detectados:\", emptyFields.map(f => f.name).join(\", \"));\n    return; // ‚ö†Ô∏è Interrompe o processo se houver campos vazios\n  }\n\n  // Se todos os campos estiverem preenchidos\n  message = \"‚úÖ Todos os campos foram preenchidos corretamente.\";\n  tools.functions.setVar({\n    args: \"\",\n    pass: {\n      keyPath: [\"sc.a7.validationMessage\"],\n      value: [message],\n    },\n  });\n\n  console.log(\"üíæ Valida√ß√£o OK ‚Äî salvando no Firebase...\");\n\n  // inicializar firebase\n  let fbInit = tools.getCtData(\"all.temp.fireInit\");\n  if (!fbInit) {\n    const { initializeApp, getApps } = await import(\"firebase/app\");\n    const cfg = tools.getCtData(\"all.temp.fireConfig\");\n    fbInit = getApps().length ? getApps()[0] : initializeApp(cfg);\n    tools.setData({ path: \"all.temp.fireInit\", value: fbInit });\n  }\n\n  // Importa Firestore e salva o documento\n  const { getFirestore, collection, addDoc, serverTimestamp } = await import(\"firebase/firestore\");\n  const db = getFirestore(fbInit);\n\n  // Monta os dados a salvar\n  const newDoc = {\n    partnerName: getVal(\"sc.A7.forms.iptsChanges.partnerName\"),\n    partnerMail: getVal(\"sc.A7.forms.iptsChanges.partnerMail\"),\n    lot: getVal(\"sc.A7.forms.iptsChanges.lot\"),\n    totalValue: getVal(\"sc.A7.forms.iptsChanges.totalValue\"),\n    firstInstallment: getVal(\"sc.A7.forms.iptsChanges.firstInstallment\"),\n    createdAt: serverTimestamp(),\n  };\n\n  try {\n    const docRef = await addDoc(collection(db, \"lots\"), newDoc);\n    console.log(\"‚úÖ Documento salvo com ID:\", docRef.id);\n\n    tools.functions.setVar({\n      args: \"\",\n      pass: {\n        keyPath: [\"sc.a7.validationMessage\"],\n        value: [\"üè¢ Documento salvo com sucesso!\"],\n      },\n    });\n  } catch (error) {\n    console.error(\"‚ùå Erro ao salvar documento:\", error);\n    tools.functions.setVar({\n      args: \"\",\n      pass: {\n        keyPath: [\"sc.a7.validationMessage\"],\n        value: [\"Erro ao salvar dados. Verifique o console.\"],\n      },\n    });\n  }\n\n//clean iptsChanges\ntools.functions.setVar({\n      args: \"\",\n      pass: {\n        keyPath: [\"sc.a7.iptChanges\"],\n        value: [\"\"],\n      },\n    });\n\n//close Add\ntools.functions.setVar({\n      args: \"\",\n      pass: {\n        keyPath: [\"all.toggles.a1.add\"],\n        value: [false],\n      },\n    });\n\n//close sideRight\ntools.functions.setVar({\n      args: \"\",\n      pass: {\n        keyPath: [\"all.toggles.sideRight\"],\n        value: [false],\n      },\n    });\n}\n","newValue":"async () => {\n  // Lista de campos obrigat√≥rios\n  const requiredFields = [\n    { path: \"sc.A7.forms.iptsChanges.partnerName\", name: \"Nome do Propriet√°rio\" },\n    { path: \"sc.A7.forms.iptsChanges.partnerMail\", name: \"E-mail\" },\n    { path: \"sc.A7.forms.iptsChanges.lot\", name: \"Obra\" },\n    { path: \"sc.A7.forms.iptsChanges.area\", name: \"√Årea\" },\n    { path: \"sc.A7.forms.iptsChanges.totalValue\", name: \"Valor total da obra\" },\n\t\t{ path: \"sc.A7.forms.iptsChanges.firstInstallment\", name: \"Valor total da entrada\" },\n  ];\n\n  // Fun√ß√£o auxiliar para obter valor seguro\n  const getVal = (path) => {\n    const val = tools.getCtData(path);\n    if (Array.isArray(val)) return val[0] ?? \"\";\n    return val ?? \"\";\n  };\n\n  // Checa campos vazios\n  const emptyFields = requiredFields.filter((f) => {\n    const v = getVal(f.path);\n    return v === \"\" || v === null || v === undefined;\n  });\n\n  // Define mensagem e estado final\n  let message = \"\";\n\n  if (emptyFields.length > 0) {\n    message = `Preencha os campos obrigat√≥rios.`;\n\n    tools.functions.setVar({\n      args: \"\",\n      pass: {\n        keyPath: [\"sc.a7.validationMessage\"],\n        value: [message],\n      },\n    });\n\n    console.warn(\"‚ö†Ô∏è Campos vazios detectados:\", emptyFields.map(f => f.name).join(\", \"));\n    return; // ‚ö†Ô∏è Interrompe o processo se houver campos vazios\n  }\n\n  // Se todos os campos estiverem preenchidos\n  message = \"‚úÖ Todos os campos foram preenchidos corretamente.\";\n  tools.functions.setVar({\n    args: \"\",\n    pass: {\n      keyPath: [\"sc.a7.validationMessage\"],\n      value: [message],\n    },\n  });\n\n  console.log(\"üíæ Valida√ß√£o OK ‚Äî salvando no Firebase...\");\n\n  // inicializar firebase\n  let fbInit = tools.getCtData(\"all.temp.fireInit\");\n  if (!fbInit) {\n    const { initializeApp, getApps } = await import(\"firebase/app\");\n    const cfg = tools.getCtData(\"all.temp.fireConfig\");\n    fbInit = getApps().length ? getApps()[0] : initializeApp(cfg);\n    tools.setData({ path: \"all.temp.fireInit\", value: fbInit });\n  }\n\n  // Importa Firestore e salva o documento\n  const { getFirestore, collection, addDoc, serverTimestamp } = await import(\"firebase/firestore\");\n  const db = getFirestore(fbInit);\n\n  // Monta os dados a salvar\n  const newDoc = {\n    partnerName: getVal(\"sc.A7.forms.iptsChanges.partnerName\"),\n    partnerMail: getVal(\"sc.A7.forms.iptsChanges.partnerMail\"),\n    lot: getVal(\"sc.A7.forms.iptsChanges.lot\"),\n    totalValue: getVal(\"sc.A7.forms.iptsChanges.totalValue\"),\n    firstInstallment: getVal(\"sc.A7.forms.iptsChanges.firstInstallment\"),\n    createdAt: serverTimestamp(),\n  };\n\n  try {\n    const docRef = await addDoc(collection(db, \"lots\"), newDoc);\n    console.log(\"‚úÖ Documento salvo com ID:\", docRef.id);\n\n    tools.functions.setVar({\n      args: \"\",\n      pass: {\n        keyPath: [\"sc.a7.validationMessage\"],\n        value: [\"üè¢ Documento salvo com sucesso!\"],\n      },\n    });\n  } catch (error) {\n    console.error(\"‚ùå Erro ao salvar documento:\", error);\n    tools.functions.setVar({\n      args: \"\",\n      pass: {\n        keyPath: [\"sc.a7.validationMessage\"],\n        value: [\"Erro ao salvar dados. Verifique o console.\"],\n      },\n    });\n  }\n\n//clean iptsChanges\ntools.functions.setVar({\n      args: \"\",\n      pass: {\n        keyPath: [\"sc.a7.iptChanges\"],\n        value: [\"\"],\n      },\n    });\n\n//close Add\ntools.functions.setVar({\n      args: \"\",\n      pass: {\n        keyPath: [\"all.toggles.a7.add\"],\n        value: [false],\n      },\n    });\n\n//close sideRight\ntools.functions.setVar({\n      args: \"\",\n      pass: {\n        keyPath: [\"all.toggles.sideRight\"],\n        value: [false],\n      },\n    });\n}\n"}}