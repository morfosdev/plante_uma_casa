{"1765291597121":{"actionType":"saveAll","createdAt":"1765291597121","actionID":"1765291597121","userID":"#TEMP","path":"system.capsules.9636fa04-7c56-404b-9b3f-a8a5504195ff.capsUseCodeInfo.capsUseInputs.sss_freeValue-0.capsIptTxtValue","oldValue":"// src/hooks/usePushNotifications.ts\nimport * as Device from \"expo-device\";\nimport * as Notifications from \"expo-notifications\";\nimport { useEffect, useRef, useState } from \"react\";\nimport { Platform } from \"react-native\";\n\nNotifications.setNotificationHandler({\n  handleNotification: async () => ({\n    shouldShowAlert: true,\n    shouldPlaySound: true,\n    shouldSetBadge: false,\n  }),\n});\n\nexport const usePushNotifications = () => {\n  const [expoPushToken, setExpoPushToken] = useState<string | null>(null);\n  const [notification, setNotification] =\n    useState<Notifications.Notification | null>(null);\n  const notificationListener = useRef<any>();\n  const responseListener = useRef<any>();\n\n  useEffect(() => {\n    registerForPushNotificationsAsync().then((token) => {\n      if (token) setExpoPushToken(token);\n    });\n\n    // Listener quando chega notificação\n    notificationListener.current =\n      Notifications.addNotificationReceivedListener((notification) => {\n        setNotification(notification);\n      });\n\n    // Listener quando o usuário clica na notificação\n    responseListener.current =\n      Notifications.addNotificationResponseReceivedListener((response) => {\n        console.log(\"User clicked notification:\", response);\n      });\n\n    return () => {\n      if (notificationListener.current) {\n        Notifications.removeNotificationSubscription(\n          notificationListener.current\n        );\n      }\n      if (responseListener.current) {\n        Notifications.removeNotificationSubscription(responseListener.current);\n      }\n    };\n  }, []);\n\n  return {\n    expoPushToken,\n    notification,\n  };\n};\n\n// -------- função de registro\nconst registerForPushNotificationsAsync = async () => {\n  try {\n    if (!Device.isDevice) {\n      console.log(\"Precisa de device físico para push notifications\");\n      return null;\n    }\n\n    // Permissão\n    const { status: existingStatus } =\n      await Notifications.getPermissionsAsync();\n    let finalStatus = existingStatus;\n\n    if (existingStatus !== \"granted\") {\n      const { status } = await Notifications.requestPermissionsAsync();\n      finalStatus = status;\n    }\n\n    if (finalStatus !== \"granted\") {\n      console.log(\"Permissão de notificação negada\");\n      return null;\n    }\n\n    // Android: configura canal\n    if (Platform.OS === \"android\") {\n      await Notifications.setNotificationChannelAsync(\"default\", {\n        name: \"default\",\n        importance: Notifications.AndroidImportance.MAX,\n        vibrationPattern: [0, 250, 250, 250],\n        lightColor: \"#FF231F7C\",\n      });\n    }\n\n    // Pega o token\n    const token = (await Notifications.getExpoPushTokenAsync()).data;\n    console.log(\"Expo push token:\", token);\n    return token;\n  } catch (err) {\n    console.log(\"Erro ao registrar push:\", err);\n    return null;\n  }\n};","newValue":"// // src/hooks/usePushNotifications.ts\n// import * as Device from \"expo-device\";\n// import * as Notifications from \"expo-notifications\";\n// import { useEffect, useRef, useState } from \"react\";\n// import { Platform } from \"react-native\";\n\n// Notifications.setNotificationHandler({\n//   handleNotification: async () => ({\n//     shouldShowAlert: true,\n//     shouldPlaySound: true,\n//     shouldSetBadge: false,\n//   }),\n// });\n\n// export const usePushNotifications = () => {\n//   const [expoPushToken, setExpoPushToken] = useState<string | null>(null);\n//   const [notification, setNotification] =\n//     useState<Notifications.Notification | null>(null);\n//   const notificationListener = useRef<any>();\n//   const responseListener = useRef<any>();\n\n//   useEffect(() => {\n//     registerForPushNotificationsAsync().then((token) => {\n//       if (token) setExpoPushToken(token);\n//     });\n\n//     // Listener quando chega notificação\n//     notificationListener.current =\n//       Notifications.addNotificationReceivedListener((notification) => {\n//         setNotification(notification);\n//       });\n\n//     // Listener quando o usuário clica na notificação\n//     responseListener.current =\n//       Notifications.addNotificationResponseReceivedListener((response) => {\n//         console.log(\"User clicked notification:\", response);\n//       });\n\n//     return () => {\n//       if (notificationListener.current) {\n//         Notifications.removeNotificationSubscription(\n//           notificationListener.current\n//         );\n//       }\n//       if (responseListener.current) {\n//         Notifications.removeNotificationSubscription(responseListener.current);\n//       }\n//     };\n//   }, []);\n\n//   return {\n//     expoPushToken,\n//     notification,\n//   };\n// };\n\n// // -------- função de registro\n// const registerForPushNotificationsAsync = async () => {\n//   try {\n//     if (!Device.isDevice) {\n//       console.log(\"Precisa de device físico para push notifications\");\n//       return null;\n//     }\n\n//     // Permissão\n//     const { status: existingStatus } =\n//       await Notifications.getPermissionsAsync();\n//     let finalStatus = existingStatus;\n\n//     if (existingStatus !== \"granted\") {\n//       const { status } = await Notifications.requestPermissionsAsync();\n//       finalStatus = status;\n//     }\n\n//     if (finalStatus !== \"granted\") {\n//       console.log(\"Permissão de notificação negada\");\n//       return null;\n//     }\n\n//     // Android: configura canal\n//     if (Platform.OS === \"android\") {\n//       await Notifications.setNotificationChannelAsync(\"default\", {\n//         name: \"default\",\n//         importance: Notifications.AndroidImportance.MAX,\n//         vibrationPattern: [0, 250, 250, 250],\n//         lightColor: \"#FF231F7C\",\n//       });\n//     }\n\n//     // Pega o token\n//     const token = (await Notifications.getExpoPushTokenAsync()).data;\n//     console.log(\"Expo push token:\", token);\n//     return token;\n//   } catch (err) {\n//     console.log(\"Erro ao registrar push:\", err);\n//     return null;\n//   }\n// };"}}