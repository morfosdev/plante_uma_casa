{"1760713104590":{"actionType":"saveAll","createdAt":"1760713104590","actionID":"1760713104590","userID":"#TEMP","path":"system.capsules.665979e6-3560-46a2-a871-c913d82be2e2.capsUseCodeInfo.capsUseInputs.sss_freeValue-0.capsIptTxtValue","oldValue":"// ---------- import Packs\nimport React from 'react';\nimport * as RN from 'react-native';\nimport * as ImagePicker from 'expo-image-picker';\n\ntype Tprops = {\n  pass: {\n    variable?: string[]; // opcional: lista inicial\n    childrenItems?: any[]; // não usado aqui\n    arrFuncs?: any[]; // não usado aqui\n    args?: any; // não usado aqui\n    onChange?: (uris: string[]) => void; // callback opcional\n    max?: number; // limite opcional\n  };\n};\n\nexport const BtnImagePicker = (props: Tprops) => {\n  const isWeb = RN.Platform.OS === 'web';\n  return isWeb ? <BtnImgPicWeb {...props} /> : <BtnImgPicNat {...props} />;\n};\n\n/* ---------------- WEB ---------------- */\nconst BtnImgPicWeb = ({ pass }: Tprops) => {\n  const { variable = [], onChange, max, arrFuncs, args } = pass || {};\n  const inputRef = React.useRef<HTMLInputElement | null>(null);\n  const [images, setImages] = React.useState<string[]>(variable);\n\n  // revoke URLs ao desmontar\n  React.useEffect(() => {\n    return () => images.forEach(u => URL.revokeObjectURL(u));\n  }, [images]);\n\n  const pickWeb = () => inputRef.current?.click();\n\n  const handleWebFile = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const fl = event.target.files;\n    if (!fl) return;\n    const selected = Array.from(fl).map(f => URL.createObjectURL(f));\n    const merged = max\n      ? [...images, ...selected].slice(0, max)\n      : [...images, ...selected];\n    setImages(merged);\n    if (arrFuncs) {\n      for (const currFunc of arrFuncs) currFunc(images, args);\n    }\n    onChange?.(merged);\n    // limpa o input pra permitir re-selecionar os mesmos arquivos\n    event.target.value = '';\n  };\n\n  const removeAt = (idx: number) => {\n    const clone = [...images];\n    const [rm] = clone.splice(idx, 1);\n    if (rm?.startsWith('blob:')) URL.revokeObjectURL(rm);\n    setImages(clone);\n    onChange?.(clone);\n\n    if (arrFuncs) {\n      for (const currFunc of arrFuncs) currFunc(images, args);\n    }\n  };\n\n  return (\n    <>\n      <RN.View style={styles.container}>\n        <ThumbGrid images={images} onRemove={removeAt} />\n        <RN.Text style={styles.title}>Adicionar Imagens</RN.Text>\n        <RN.Text style={styles.subtitle}>\n          Selecione ou tire fotos para mostrar o progresso\n        </RN.Text>\n        <RN.Pressable style={styles.btn} onPress={pickWeb}>\n          <RN.Text style={styles.btnTxt}>Adicionar</RN.Text>\n        </RN.Pressable>\n      </RN.View>\n\n      <input\n        ref={inputRef}\n        type=\"file\"\n        accept=\"image/*\"\n        multiple\n        style={{ display: 'none' }}\n        onChange={handleWebFile}\n      />\n    </>\n  );\n};\n\n/* --------------- NATIVO --------------- */\nconst BtnImgPicNat = ({ pass }: Tprops) => {\n  const { variable = [], onChange, max } = pass || {};\n  const [images, setImages] = React.useState<string[]>(variable);\n\n  const pickNative = async () => {\n    const { status } = await ImagePicker.requestMediaLibraryPermissionsAsync();\n    if (status !== 'granted') {\n      alert('Permissão para acessar a galeria foi negada');\n      return;\n    }\n\n    const result = await ImagePicker.launchImageLibraryAsync({\n      mediaTypes: ImagePicker.MediaTypeOptions.Images,\n      allowsMultipleSelection: true, // múltiplas\n      selectionLimit: max ?? 0, // 0 = sem limite (iOS). Ignorado em algumas versões\n      allowsEditing: false,\n      quality: 1,\n    });\n\n    if (!result.canceled) {\n      const picked = result.assets.map(a => a.uri);\n      const merged = max\n        ? [...images, ...picked].slice(0, max)\n        : [...images, ...picked];\n      setImages(merged);\n      onChange?.(merged);\n    }\n  };\n\n  const removeAt = (idx: number) => {\n    const clone = [...images];\n    clone.splice(idx, 1);\n    setImages(clone);\n    onChange?.(clone);\n  };\n\n  return (\n    <RN.View style={styles.container}>\n      <ThumbGrid images={images} onRemove={removeAt} />\n      <RN.Text style={styles.title}>Adicionar Imagens</RN.Text>\n      <RN.Text style={styles.subtitle}>\n        Selecione ou tire fotos para mostrar o progresso\n      </RN.Text>\n      <RN.Pressable style={styles.btn} onPress={pickNative}>\n        <RN.Text style={styles.btnTxt}>Adicionar</RN.Text>\n      </RN.Pressable>\n    </RN.View>\n  );\n};\n\n/* ------- Grade de miniaturas reutilizável ------- */\nconst ThumbGrid = ({\n  images,\n  onRemove,\n}: {\n  images: string[];\n  onRemove: (idx: number) => void;\n}) => {\n  if (!images.length) return null;\n  return (\n    <RN.View style={thumb.grid}>\n      {images.map((uri, idx) => (\n        <RN.View key={uri + idx} style={thumb.item}>\n          <RN.Image source={{ uri }} style={thumb.img} />\n          <RN.Pressable\n            hitSlop={8}\n            style={thumb.x}\n            onPress={() => onRemove(idx)}\n          >\n            <RN.Text style={thumb.xTxt}>×</RN.Text>\n          </RN.Pressable>\n        </RN.View>\n      ))}\n    </RN.View>\n  );\n};\n\n/* ---------------- STYLES ---------------- */\nconst styles = RN.StyleSheet.create({\n  container: {\n    width: '100%',\n    minHeight: 180,\n    alignItems: 'center',\n    justifyContent: 'center',\n    borderStyle: 'dashed',\n    borderColor: '#D5DBE3',\n    borderRadius: 12,\n    borderWidth: 2,\n    padding: 20,\n    gap: 16,\n    backgroundColor: '#fff',\n  },\n  title: {\n    fontSize: 18,\n    fontWeight: '700',\n    textAlign: 'center',\n  },\n  subtitle: {\n    fontSize: 14,\n    textAlign: 'center',\n    color: '#4B5563',\n  },\n  btn: {\n    backgroundColor: '#E8EDF5',\n    justifyContent: 'center',\n    alignItems: 'center',\n    borderRadius: 10,\n    height: 36,\n    paddingHorizontal: 16,\n  },\n  btnTxt: {\n    fontSize: 14,\n    fontWeight: '700',\n  },\n});\n\nconst thumb = RN.StyleSheet.create({\n  grid: {\n    width: '100%',\n    flexDirection: 'row',\n    flexWrap: 'wrap',\n    gap: 8,\n    justifyContent: 'center',\n    columnGap: 10,\n    rowGap: 10,\n  },\n  item: {\n    position: 'relative',\n    width: '45%',\n    aspectRatio: 1.6,\n    borderRadius: 6,\n    overflow: 'hidden',\n  },\n  img: { width: '100%', height: '100%' },\n  x: {\n    position: 'absolute',\n    top: 4,\n    right: 4,\n    width: 22,\n    height: 22,\n    borderRadius: 11,\n    backgroundColor: 'rgba(0,0,0,0.5)',\n    alignItems: 'center',\n    justifyContent: 'center',\n  },\n  xTxt: { color: '#fff', fontSize: 16, lineHeight: 16, fontWeight: '700' },\n});\n","newValue":"// ---------- import Packs\nimport React from 'react';\nimport * as RN from 'react-native';\nimport * as ImagePicker from 'expo-image-picker';\n\ntype Tprops = {\n  pass: {\n    variable?: string[]; // opcional: lista inicial\n    childrenItems?: any[]; // não usado aqui\n    arrFuncs?: any[]; // não usado aqui\n    args?: any; // não usado aqui\n    onChange?: (uris: string[]) => void; // callback opcional\n    max?: number; // limite opcional\n  };\n};\n\nexport const BtnImagePicker = (props: Tprops) => {\n  const isWeb = RN.Platform.OS === 'web';\n  return isWeb ? <BtnImgPicWeb {...props} /> : <BtnImgPicNat {...props} />;\n};\n\n/* ---------------- WEB ---------------- */\nconst BtnImgPicWeb = ({ pass }: Tprops) => {\n  const { variable = [], onChange, max, arrFuncs, args } = pass || {};\n  const inputRef = React.useRef<HTMLInputElement | null>(null);\n  const [images, setImages] = React.useState<string[]>(variable);\n\n  // revoke URLs ao desmontar\n  React.useEffect(() => {\n    if (arrFuncs) {\n      for (const currFunc of arrFuncs) currFunc(images, args);\n    }\n    return () => images.forEach(u => URL.revokeObjectURL(u));\n  }, [images]);\n\n  const pickWeb = () => inputRef.current?.click();\n\n  const handleWebFile = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const fl = event.target.files;\n    if (!fl) return;\n    const selected = Array.from(fl).map(f => URL.createObjectURL(f));\n    const merged = max\n      ? [...images, ...selected].slice(0, max)\n      : [...images, ...selected];\n    setImages(merged);\n    onChange?.(merged);\n    // limpa o input pra permitir re-selecionar os mesmos arquivos\n    event.target.value = '';\n  };\n\n  const removeAt = (idx: number) => {\n    const clone = [...images];\n    const [rm] = clone.splice(idx, 1);\n    if (rm?.startsWith('blob:')) URL.revokeObjectURL(rm);\n    setImages(clone);\n    onChange?.(clone);\n  };\n\n  return (\n    <>\n      <RN.View style={styles.container}>\n        <ThumbGrid images={images} onRemove={removeAt} />\n        <RN.Text style={styles.title}>Adicionar Imagens</RN.Text>\n        <RN.Text style={styles.subtitle}>\n          Selecione ou tire fotos para mostrar o progresso\n        </RN.Text>\n        <RN.Pressable style={styles.btn} onPress={pickWeb}>\n          <RN.Text style={styles.btnTxt}>Adicionar</RN.Text>\n        </RN.Pressable>\n      </RN.View>\n\n      <input\n        ref={inputRef}\n        type=\"file\"\n        accept=\"image/*\"\n        multiple\n        style={{ display: 'none' }}\n        onChange={handleWebFile}\n      />\n    </>\n  );\n};\n\n/* --------------- NATIVO --------------- */\nconst BtnImgPicNat = ({ pass }: Tprops) => {\n  const { variable = [], onChange, max } = pass || {};\n  const [images, setImages] = React.useState<string[]>(variable);\n\n  const pickNative = async () => {\n    const { status } = await ImagePicker.requestMediaLibraryPermissionsAsync();\n    if (status !== 'granted') {\n      alert('Permissão para acessar a galeria foi negada');\n      return;\n    }\n\n    const result = await ImagePicker.launchImageLibraryAsync({\n      mediaTypes: ImagePicker.MediaTypeOptions.Images,\n      allowsMultipleSelection: true, // múltiplas\n      selectionLimit: max ?? 0, // 0 = sem limite (iOS). Ignorado em algumas versões\n      allowsEditing: false,\n      quality: 1,\n    });\n\n    if (!result.canceled) {\n      const picked = result.assets.map(a => a.uri);\n      const merged = max\n        ? [...images, ...picked].slice(0, max)\n        : [...images, ...picked];\n      setImages(merged);\n      onChange?.(merged);\n    }\n  };\n\n  const removeAt = (idx: number) => {\n    const clone = [...images];\n    clone.splice(idx, 1);\n    setImages(clone);\n    onChange?.(clone);\n  };\n\n  return (\n    <RN.View style={styles.container}>\n      <ThumbGrid images={images} onRemove={removeAt} />\n      <RN.Text style={styles.title}>Adicionar Imagens</RN.Text>\n      <RN.Text style={styles.subtitle}>\n        Selecione ou tire fotos para mostrar o progresso\n      </RN.Text>\n      <RN.Pressable style={styles.btn} onPress={pickNative}>\n        <RN.Text style={styles.btnTxt}>Adicionar</RN.Text>\n      </RN.Pressable>\n    </RN.View>\n  );\n};\n\n/* ------- Grade de miniaturas reutilizável ------- */\nconst ThumbGrid = ({\n  images,\n  onRemove,\n}: {\n  images: string[];\n  onRemove: (idx: number) => void;\n}) => {\n  if (!images.length) return null;\n  return (\n    <RN.View style={thumb.grid}>\n      {images.map((uri, idx) => (\n        <RN.View key={uri + idx} style={thumb.item}>\n          <RN.Image source={{ uri }} style={thumb.img} />\n          <RN.Pressable\n            hitSlop={8}\n            style={thumb.x}\n            onPress={() => onRemove(idx)}\n          >\n            <RN.Text style={thumb.xTxt}>×</RN.Text>\n          </RN.Pressable>\n        </RN.View>\n      ))}\n    </RN.View>\n  );\n};\n\n/* ---------------- STYLES ---------------- */\nconst styles = RN.StyleSheet.create({\n  container: {\n    width: '100%',\n    minHeight: 180,\n    alignItems: 'center',\n    justifyContent: 'center',\n    borderStyle: 'dashed',\n    borderColor: '#D5DBE3',\n    borderRadius: 12,\n    borderWidth: 2,\n    padding: 20,\n    gap: 16,\n    backgroundColor: '#fff',\n  },\n  title: {\n    fontSize: 18,\n    fontWeight: '700',\n    textAlign: 'center',\n  },\n  subtitle: {\n    fontSize: 14,\n    textAlign: 'center',\n    color: '#4B5563',\n  },\n  btn: {\n    backgroundColor: '#E8EDF5',\n    justifyContent: 'center',\n    alignItems: 'center',\n    borderRadius: 10,\n    height: 36,\n    paddingHorizontal: 16,\n  },\n  btnTxt: {\n    fontSize: 14,\n    fontWeight: '700',\n  },\n});\n\nconst thumb = RN.StyleSheet.create({\n  grid: {\n    width: '100%',\n    flexDirection: 'row',\n    flexWrap: 'wrap',\n    gap: 8,\n    justifyContent: 'center',\n    columnGap: 10,\n    rowGap: 10,\n  },\n  item: {\n    position: 'relative',\n    width: '45%',\n    aspectRatio: 1.6,\n    borderRadius: 6,\n    overflow: 'hidden',\n  },\n  img: { width: '100%', height: '100%' },\n  x: {\n    position: 'absolute',\n    top: 4,\n    right: 4,\n    width: 22,\n    height: 22,\n    borderRadius: 11,\n    backgroundColor: 'rgba(0,0,0,0.5)',\n    alignItems: 'center',\n    justifyContent: 'center',\n  },\n  xTxt: { color: '#fff', fontSize: 16, lineHeight: 16, fontWeight: '700' },\n});\n"}}