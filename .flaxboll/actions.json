{"1765465739514":{"actionType":"saveAll","createdAt":"1765465739514","actionID":"1765465739514","userID":"#TEMP","path":"system.capsules.6659ed3a-5f02-4f95-9ff0-a4eff2b04dc2.capsUseCodeInfo.capsUseInputs.sss_custom_caps_el-0.capsIptTxtValue","oldValue":"() => {\n  console.log(\"Botão Recibo\", args);\n\n  // ===== item =====\n  const item = tools?.findFlatItem ? tools.findFlatItem(args) : null;\n  if (!item || typeof item !== \"object\") {\n    console.log(\"Botão Recibo ERRO: item inválido\", item);\n    return (\n      <RN.Pressable>\n        <RN.Text style={{ color: \"#CCCCCC\", fontSize: 14, fontWeight: \"bold\" }}>\n          ↪\n        </RN.Text>\n      </RN.Pressable>\n    );\n  }\n  console.log(\"Botão Recibo 2\", item);\n\n  // ===== installmentId =====\n  const installmentId = item?.installmentId;\n  console.log(\"Botão Recibo 3\", installmentId);\n\n  // Só considera inválido se for null/undefined/string vazia\n  if (\n    installmentId === null ||\n    installmentId === undefined ||\n    installmentId === \"\"\n  ) {\n    console.log(\"Botão Recibo ERRO: installmentId inválido\");\n    return (\n      <RN.Pressable>\n        <RN.Text style={{ color: \"#CCCCCC\", fontSize: 14, fontWeight: \"bold\" }}>\n          ↪\n        </RN.Text>\n      </RN.Pressable>\n    );\n  }\n\n  // ===== receipts =====\n  const receipts = tools?.getCtData\n    ? tools.getCtData(\"sc.A9.currents.currLoteData.receipts\")\n    : null;\n\n  const safeReceipts = receipts && typeof receipts === \"object\" ? receipts : {};\n\n  console.log(\"Botão Recibo 4\", safeReceipts);\n\n  // ===== currReceipt =====\n  const currReceipt =\n    safeReceipts &&\n    Object.prototype.hasOwnProperty.call(safeReceipts, installmentId)\n      ? safeReceipts[installmentId]\n      : null;\n\n  console.log(\"Botão Recibo 5\", currReceipt);\n\n  // ===== receiptUrl =====\n  const receiptUrl =\n    currReceipt && typeof currReceipt === \"object\"\n      ? currReceipt.receiptUrl || null\n      : null;\n  const fileName =\n    currReceipt && typeof currReceipt === \"object\"\n      ? currReceipt.fileName || \"recibo\"\n      : \"recibo\";\n\n  console.log(\"Botão Recibo 6\", receiptUrl);\n\n  // ===== estilo condicionado =====\n  const condStyle = {\n    color: receiptUrl ? \"#315e2d\" : \"#CCCCCC\",\n    fontSize: 14,\n    fontWeight: \"bold\",\n  };\n\n  // ===== função de download (web) =====\n  const handleDownload = (uri: string, filename: string) => {\n    if (!uri) return;\n\n    if (RN.Platform.OS === \"web\" && typeof document !== \"undefined\") {\n      const link = document.createElement(\"a\");\n      link.href = uri;\n\n      return;\n    }\n  };\n\n  // ===== retorno =====\n  return (\n    <RN.Pressable\n      onPress={() => {\n        console.log(\"Clicou no botão de recibo\");\n        if (receiptUrl) handleDownload(receiptUrl, fileName);\n      }}\n    >\n      <RN.Text style={condStyle}>↪</RN.Text>\n    </RN.Pressable>\n  );\n}","newValue":"() => {\n  console.log(\"Botão Recibo\", args);\n\n  // ===== item =====\n  const item = tools?.findFlatItem ? tools.findFlatItem(args) : null;\n  if (!item || typeof item !== \"object\") {\n    console.log(\"Botão Recibo ERRO: item inválido\", item);\n    return (\n      <RN.Pressable>\n        <RN.Text style={{ color: \"#CCCCCC\", fontSize: 14, fontWeight: \"bold\" }}>\n          ↪\n        </RN.Text>\n      </RN.Pressable>\n    );\n  }\n  console.log(\"Botão Recibo 2\", item);\n\n  // ===== installmentId =====\n  const installmentId = item?.installmentId;\n  console.log(\"Botão Recibo 3\", installmentId);\n\n  // Só considera inválido se for null/undefined/string vazia\n  if (\n    installmentId === null ||\n    installmentId === undefined ||\n    installmentId === \"\"\n  ) {\n    console.log(\"Botão Recibo ERRO: installmentId inválido\");\n    return (\n      <RN.Pressable>\n        <RN.Text style={{ color: \"#CCCCCC\", fontSize: 14, fontWeight: \"bold\" }}>\n          ↪\n        </RN.Text>\n      </RN.Pressable>\n    );\n  }\n\n  // ===== receipts =====\n  const receipts = tools?.getCtData\n    ? tools.getCtData(\"sc.A9.currents.currLoteData.receipts\")\n    : null;\n\n  const safeReceipts = receipts && typeof receipts === \"object\" ? receipts : {};\n\n  console.log(\"Botão Recibo 4\", safeReceipts);\n\n  // ===== currReceipt =====\n  const currReceipt =\n    safeReceipts &&\n    Object.prototype.hasOwnProperty.call(safeReceipts, installmentId)\n      ? safeReceipts[installmentId]\n      : null;\n\n  console.log(\"Botão Recibo 5\", currReceipt);\n\n  // ===== receiptUrl =====\n  const receiptUrl =\n    currReceipt && typeof currReceipt === \"object\"\n      ? currReceipt.receiptUrl || null\n      : null;\n  const fileName =\n    currReceipt && typeof currReceipt === \"object\"\n      ? currReceipt.fileName || \"recibo\"\n      : \"recibo\";\n\n  console.log(\"Botão Recibo 6\", receiptUrl);\n\n  // ===== estilo condicionado =====\n  const condStyle = {\n    color: receiptUrl ? \"#315e2d\" : \"#CCCCCC\",\n    fontSize: 14,\n    fontWeight: \"bold\",\n  };\n\n  // ===== função de download (web) =====\n  const handleDownload = (uri: string, filename: string) => {\n    if (!uri) return;\n\n    if (RN.Platform.OS === \"web\" && typeof document !== \"undefined\") {\n      const link = document.createElement(\"a\");\n      link.href = uri;\n      link.download = filename || \"imagem\" + '.png';\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      return;\n    }\n\n    RN.Linking.openURL(uri);\n  };\n\n  // ===== retorno =====\n  return (\n    <RN.Pressable\n      onPress={() => {\n        console.log(\"Clicou no botão de recibo\");\n        if (receiptUrl) handleDownload(receiptUrl, fileName);\n      }}\n    >\n      <RN.Text style={condStyle}>↪</RN.Text>\n    </RN.Pressable>\n  );\n}"}}