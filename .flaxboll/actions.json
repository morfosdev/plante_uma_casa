{"1764182257628":{"actionType":"saveAll","createdAt":"1764182257628","actionID":"1764182257628","userID":"#TEMP","path":"system.capsules.0391e03b-9ab3-4720-bb9c-35d4c28ddce2.capsUseCodeInfo.capsUseInputs.sss_custom_caps-0.capsIptTxtValue","oldValue":"(args) => {\n  const css1 =\n    \"color: limegreen; background-color: darkcyan; font-size: 11px; padding: 2px 6px; border-radius: 3px\";\n\n  const item = tools.findFlatItem(args);\n  const stepsList = tools.getCtData(\"sc.B7.lists.list1\");\n  const staticList = tools.getCtData(\"sc.B7.statics.steps\");\n  const stepIdRaw = item?.stepId;\n\n  // ---- Guards\n  if (!item || stepIdRaw == null) {\n    console.warn(\"Step handler: item ou stepId ausente.\", { item });\n    return;\n  }\n\n  const stepId = String(stepIdRaw);\n  const pathSideRight = \"all.toggles.sideRight\";\n  const pathEdit = \"all.toggles.b9.editSteps\";\n  const pathNew = \"all.toggles.b8.addSteps\";\n\n  // Abre painel lateral (comum)\n  tools.setData({ path: pathSideRight, value: true });\n\n  // Procura match por stepId\n  const matched = Array.isArray(stepsList)\n    ? stepsList.find((d: any) => String(d?.stepId) === stepId)\n    : undefined;\n\n  const condMatch = Boolean(matched);\n  const currId = matched?.docId;\n\n  console.log({ item, stepsList, matched, condMatch, staticList });\n\n  function findStepById(arr, stepId) {\n    if (!Array.isArray(arr) || !stepId) return null;\n\n    for (const group of arr) {\n      if (!group?.subs) continue;\n\n      const found = group.subs.find((s) => s.stepId === stepId);\n      if (found) return { stepLabel: group.label, subStepLabel: found.label };\n    }\n\n    return null;\n  }\n  const selectStepStatic = findStepById(staticList, stepId);\n\n  // if (!condMatch) {\n  //     // ---- Modo Adicionar\n  //     console.log(\"%cAdd New Step Mode - \" + pathNew, css1);\n\n  //     tools.setData({ path: pathNew, value: true });\n  //     tools.setData({ path: pathEdit, value: false });\n\n  //     // stepId sempre preenchido\n  //     tools.setData({ path: \"sc.b8.editChanges.stepId\", value: stepId });\n\n  //     // Evita undefined: use vazio ou herde do item\n\n  //     // (Opcional) limpar possíveis resíduos do form de edição\n  //     tools.setData({ path: \"sc.B9.forms.editChanges.docId\", value: \"\" });\n  //     tools.setData({ path: \"sc.B9.forms.editChanges.stepId\", value: \"\" });\n  //     return;\n  // }\n\n  // ---- Modo Editar\n  console.log(\"%cEdit Step Mode - \" + pathEdit, css1);\n\n  tools.setData({ path: pathEdit, value: true });\n  tools.setData({ path: pathNew, value: false });\n\n  // Define os valores base no formulário de edição\n  tools.setData({\n    path: \"sc.B9.forms.editChanges\",\n    value: matched, // ✅ Passa todos os dados do documento\n  });\n\n  // Campos específicos importantes\n  tools.setData({ path: \"sc.B9.forms.editChanges.docId\", value: currId ?? \"\" });\n  tools.setData({ path: \"sc.B9.forms.editChanges.stepId\", value: stepId });\n\n  // (Opcional) limpar possíveis resíduos do form de novo\n  tools.setData({ path: \"sc.B8.forms.iptsChanges.stepId\", value: \"\" });\n\n  // Set CtData\n  tools.setData({\n    path: \"sc.B9.forms.viewChanges.stepLabel\",\n    value: selectStepStatic?.stepLabel ?? \"\",\n  });\n\n  tools.setData({\n    path: \"sc.B9.forms.viewChanges.subStepLabel\",\n    value: selectStepStatic?.subStepLabel ?? \"\",\n  });\n}\n","newValue":"(args) => {\n  const css1 =\n    \"color: limegreen; background-color: darkcyan; font-size: 11px; padding: 2px 6px; border-radius: 3px\";\n\n  const item = tools.findFlatItem(args);\n  const stepsList = tools.getCtData(\"sc.B7.lists.list1\");\n  const staticList = tools.getCtData(\"sc.B7.statics.steps\");\n  const stepIdRaw = item?.stepId;\n\n  // ---- Guards\n  if (!item || stepIdRaw == null) {\n    console.warn(\"Step handler: item ou stepId ausente.\", { item });\n    return;\n  }\n\n  const stepId = String(stepIdRaw);\n  const pathSideRight = \"all.toggles.sideRight\";\n  const pathEdit = \"all.toggles.b9.editSteps\";\n  const pathNew = \"all.toggles.b8.addSteps\";\n\n  // Abre painel lateral (comum)\n  tools.setData({ path: pathSideRight, value: true });\n\n  // Procura match por stepId\n  const matched = Array.isArray(stepsList)\n    ? stepsList.find((d: any) => String(d?.stepId) === stepId)\n    : undefined;\n\n  const condMatch = Boolean(matched);\n  const currId = matched?.docId;\n\n  console.log({ item, stepsList, matched, condMatch, staticList });\n\n  function findStepById(arr, stepId) {\n    if (!Array.isArray(arr) || !stepId) return null;\n\n    for (const group of arr) {\n      if (!group?.subs) continue;\n\n      const found = group.subs.find((s) => s.stepId === stepId);\n      if (found) return { stepLabel: group.label, subStepLabel: found.label };\n    }\n\n    return null;\n  }\n  const selectStepStatic = findStepById(staticList, stepId);\n\n  // if (!condMatch) {\n  //     // ---- Modo Adicionar\n  //     console.log(\"%cAdd New Step Mode - \" + pathNew, css1);\n\n  //     tools.setData({ path: pathNew, value: true });\n  //     tools.setData({ path: pathEdit, value: false });\n\n  //     // stepId sempre preenchido\n  //     tools.setData({ path: \"sc.b8.editChanges.stepId\", value: stepId });\n\n  //     // Evita undefined: use vazio ou herde do item\n\n  //     // (Opcional) limpar possíveis resíduos do form de edição\n  //     tools.setData({ path: \"sc.B9.forms.editChanges.docId\", value: \"\" });\n  //     tools.setData({ path: \"sc.B9.forms.editChanges.stepId\", value: \"\" });\n  //     return;\n  // }\n\n  // ---- Modo Editar\n  console.log(\"%cEdit Step Mode - \" + pathEdit, css1);\n\n  tools.setData({ path: pathEdit, value: true });\n  tools.setData({ path: pathNew, value: false });\n\n  // Define os valores base no formulário de edição\n  tools.setData({\n    path: \"sc.B9.forms.editChanges\",\n    value: matched, // ✅ Passa todos os dados do documento\n  });\n\n  // Campos específicos importantes\n  tools.setData({ path: \"sc.B9.forms.editChanges.docId\", value: currId ?? \"\" });\n  tools.setData({ path: \"sc.B9.forms.editChanges.stepId\", value: stepId });\n\n  // (Opcional) limpar possíveis resíduos do form de novo\n  tools.setData({ path: \"sc.B8.forms.iptsChanges.stepId\", value: \"\" });\n\n  // Set CtData\n  tools.setData({\n    path: \"sc.B9.forms.viewChanges.stepLabel\",\n    value: selectStepStatic?.stepLabel ?? \"\",\n  });\n\n  tools.setData({\n    path: \"sc.B9.forms.viewChanges.subStepLabel\",\n    value: selectStepStatic?.subStepLabel ?? \"\",\n  });\n}"}}