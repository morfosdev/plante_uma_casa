{"1762278034477":{"actionType":"saveAll","createdAt":"1762278034477","actionID":"1762278034477","userID":"#TEMP","path":"system.capsules.3266c498-6536-4e6d-a1a0-f614253e06d3.capsUseCodeInfo.capsUseInputs.sss_freeValue-0.capsIptTxtValue","oldValue":"// ---------- import Packs\nimport * as DocumentPicker from \"expo-document-picker\";\nimport React from \"react\";\nimport * as RN from \"react-native\";\n\ntype Tprops = {\n  pass: {\n    variable?: string[]; // lista inicial de URIs - só UI\n    childrenItems?: any[]; // não usado\n    arrFuncs?: Array<(payload: any, args?: any) => any | Promise<any>>; // callbacks que recebem FILES/ASSETS\n    args?: any; // args repassados aos callbacks\n    onChange?: (uris: string[]) => void; // callback UI com as URIs\n    max?: number; // limite de itens\n  };\n};\n\nexport const BtnDocumentPicker = (props: Tprops) => {\n  const isWeb = RN.Platform.OS === \"web\";\n  return isWeb ? <BtnWeb {...props} /> : <BtnNat {...props} />;\n};\n\n/* ---------------- WEB ---------------- */\nconst BtnWeb = ({ pass }: Tprops) => {\n  const { variable = [], onChange, max, arrFuncs, args } = pass || {};\n  const inputRef = React.useRef<HTMLInputElement | null>(null);\n\n  // UI\n  const [docUris, setDocUris] = React.useState<string[]>(variable);\n  const [docNames, setDocNames] = React.useState<string[]>([]);\n  // Upload: Files reais\n  const [files, setFiles] = React.useState<File[]>([]);\n\n  // Dispara callbacks sempre que os FILES mudam\n  React.useEffect(() => {\n    if (arrFuncs) for (const fn of arrFuncs) fn(files, args);\n    // revoke das URLs quando componente desmontar\n    return () =>\n      docUris.forEach((u) => u.startsWith(\"blob:\") && URL.revokeObjectURL(u));\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [files]);\n\n  const pickWeb = () => inputRef.current?.click();\n\n  const handleWebFile = (event: React.ChangeEvent<HTMLInputElement>) => {\n    console.log(\"Document Picker - Web - Selected files\", event.target.files);\n    const fl = event.target.files;\n    if (!fl) return;\n\n    const newFiles = Array.from(fl);\n    // usamos blob URLs como \"preview\" (e também servem pra leitura upload, se quiser)\n    const newUris = newFiles.map((f) => URL.createObjectURL(f));\n    const newNames = newFiles.map((f) => f.name);\n\n    const nextUris = max\n      ? [...docUris, ...newUris].slice(0, max)\n      : [...docUris, ...newUris];\n    const nextFiles = max\n      ? [...files, ...newFiles].slice(0, max)\n      : [...files, ...newFiles];\n    const nextNames = max\n      ? [...docNames, ...newNames].slice(0, max)\n      : [...docNames, ...newNames];\n\n    setDocUris(nextUris);\n    setFiles(nextFiles);\n    setDocNames(nextNames);\n    onChange?.(nextUris);\n\n    // permitir re-selecionar os mesmos arquivos\n    event.target.value = \"\";\n  };\n\n  const removeAt = (idx: number) => {\n    const uris = [...docUris];\n    const fls = [...files];\n    const nms = [...docNames];\n\n    const [rm] = uris.splice(idx, 1);\n    fls.splice(idx, 1);\n    nms.splice(idx, 1);\n\n    if (rm?.startsWith(\"blob:\")) URL.revokeObjectURL(rm);\n\n    setDocUris(uris);\n    setFiles(fls);\n    setDocNames(nms);\n    onChange?.(uris);\n  };\n\n  return (\n    <>\n      <RN.View style={styles.container}>\n        <ThumbGrid images={docUris} names={docNames} onRemove={removeAt} />\n\n        <RN.Text style={styles.title}>Adicionar Documentos</RN.Text>\n        <RN.Text style={styles.subtitle}>\n          Selecione arquivos PDF, Word ou TXT\n        </RN.Text>\n        <RN.Pressable style={styles.btn} onPress={pickWeb}>\n          <RN.Text style={styles.btnTxt}>Adicionar</RN.Text>\n        </RN.Pressable>\n      </RN.View>\n\n      <input\n        ref={inputRef}\n        type=\"file\"\n        // Somente documentos\n        accept=\"application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,text/plain\"\n        multiple\n        style={{ display: \"none\" }}\n        onChange={handleWebFile}\n      />\n    </>\n  );\n};\n\n/* --------------- NATIVO --------------- */\nconst BtnNat = ({ pass }: Tprops) => {\n  const { variable = [], onChange, max, arrFuncs, args } = pass || {};\n\n  // UI: URIs e nomes\n  const [docUris, setDocUris] = React.useState<string[]>(variable);\n  const [docNames, setDocNames] = React.useState<string[]>([]);\n  // Upload: objetos do DocumentPicker\n  const [assets, setAssets] = React.useState<\n    Array<{ uri: string; name?: string; mimeType?: string; size?: number }>\n  >([]);\n\n  // Dispara callbacks sempre que os ASSETS mudam\n  React.useEffect(() => {\n    if (arrFuncs) for (const fn of arrFuncs) fn(assets, args);\n    return () => {\n      /* nada a revogar no nativo */\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [assets]);\n\n  const pickNative = async () => {\n    const result = await DocumentPicker.getDocumentAsync({\n      multiple: true,\n      type: [\n        \"application/pdf\",\n        \"application/msword\",\n        \"application/vnd.openxmlformats-officedocument.wordprocessingml.document\",\n        \"text/plain\",\n      ],\n      copyToCacheDirectory: true,\n    });\n\n    if (!result.canceled) {\n      const newUris = result.assets.map((a) => a.uri);\n      const newNames = result.assets.map((a) => a.name ?? \"Documento\");\n\n      const nextUris = max\n        ? [...docUris, ...newUris].slice(0, max)\n        : [...docUris, ...newUris];\n      const nextNames = max\n        ? [...docNames, ...newNames].slice(0, max)\n        : [...docNames, ...newNames];\n\n      const newAssets = result.assets.map((a) => ({\n        uri: a.uri,\n        name: a.name,\n        mimeType: a.mimeType,\n        size: a.size,\n      }));\n      const nextAssets = max\n        ? [...assets, ...newAssets].slice(0, max)\n        : [...assets, ...newAssets];\n\n      setDocUris(nextUris); // UI\n      setDocNames(nextNames); // nomes\n      setAssets(nextAssets); // Upload\n      onChange?.(nextUris);\n    }\n  };\n\n  const removeAt = (idx: number) => {\n    const uris = [...docUris];\n    const ats = [...assets];\n    const nms = [...docNames];\n\n    uris.splice(idx, 1);\n    ats.splice(idx, 1);\n    nms.splice(idx, 1);\n\n    setDocUris(uris);\n    setAssets(ats);\n    setDocNames(nms);\n    onChange?.(uris);\n  };\n\n  return (\n    <RN.View style={styles.container}>\n      <ThumbGrid images={docUris} names={docNames} onRemove={removeAt} />\n      <RN.Text style={styles.title}>Adicionar Documentos</RN.Text>\n      <RN.Text style={styles.subtitle}>\n        Selecione arquivos PDF, Word ou TXT\n      </RN.Text>\n      <RN.Pressable style={styles.btn} onPress={pickNative}>\n        <RN.Text style={styles.btnTxt}>Adicionar</RN.Text>\n      </RN.Pressable>\n    </RN.View>\n  );\n};\n\n/* ------- Grade de miniaturas reutilizável ------- */\nconst ThumbGrid = ({\n  images,\n  names,\n  onRemove,\n}: {\n  images: string[];\n  names?: string[];\n  onRemove: (idx: number) => void;\n}) => {\n  if (!images.length) return null;\n  return (\n    <RN.View style={thumb.grid}>\n      <RN.Text style={thumb.xTxt2}>Nome do Arquivo</RN.Text>\n      {images.map((uri, idx) => (\n        <RN.View key={uri + idx} style={thumb.item}>\n          {/* Nome do documento */}\n          <RN.View\n            style={{ flex: 1, alignItems: \"center\", justifyContent: \"center\" }}\n          >\n            <RN.Text\n              numberOfLines={2}\n              ellipsizeMode=\"tail\"\n              style={{ fontWeight: \"700\", fontSize: 12, textAlign: \"center\" }}\n            >\n              {names?.[idx] ?? \"Documento\"}\n            </RN.Text>\n          </RN.View>\n\n          {/* Botão remover */}\n          <RN.Pressable\n            hitSlop={8}\n            style={thumb.x}\n            onPress={() => onRemove(idx)}\n          >\n            <RN.Text style={thumb.xTxt}>×</RN.Text>\n          </RN.Pressable>\n        </RN.View>\n      ))}\n    </RN.View>\n  );\n};\n\n/* ---------------- STYLES ---------------- */\nconst styles = RN.StyleSheet.create({\n  container: {\n    width: \"100%\",\n    minHeight: 180,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    borderStyle: \"dashed\",\n    borderColor: \"#D5DBE3\",\n    borderRadius: 12,\n    borderWidth: 2,\n    padding: 20,\n    gap: 16,\n    backgroundColor: \"#fff\",\n  },\n  title: { fontSize: 18, fontWeight: \"700\", textAlign: \"center\" },\n  subtitle: { fontSize: 14, textAlign: \"center\", color: \"#4B5563\" },\n  btn: {\n    backgroundColor: \"#E8EDF5\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    borderRadius: 10,\n    height: 36,\n    paddingHorizontal: 16,\n  },\n  btnTxt: { fontSize: 14, fontWeight: \"700\" },\n});\n\nconst thumb = RN.StyleSheet.create({\n  grid: {\n    width: \"100%\",\n    flexDirection: \"row\",\n    flexWrap: \"wrap\",\n    justifyContent: \"center\",\n    columnGap: 10,\n    rowGap: 10,\n    borderWidth: 2,\n    borderColor: \"#E5E7EB\",\n    padding: 8,\n    marginBottom: 8,\n  },\n  item: {\n    position: \"relative\",\n    width: \"45%\",\n    aspectRatio: 1.6,\n    borderRadius: 6,\n    overflow: \"hidden\",\n  },\n  img: { width: \"100%\", height: \"100%\" },\n  x: {\n    position: \"absolute\",\n    top: 4,\n    right: 4,\n    width: 22,\n    height: 22,\n    borderRadius: 11,\n    backgroundColor: \"rgba(0,0,0,0.5)\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  xTxt: { color: \"#fff\", fontSize: 16, lineHeight: 16, fontWeight: \"700\" },\n  xTxt2: { fontSize: 14, lineHeight: 16 },\n});\n","newValue":"// ---------- import Packs\nimport * as DocumentPicker from \"expo-document-picker\";\nimport React from \"react\";\nimport * as RN from \"react-native\";\n\ntype Tprops = {\n  pass: {\n    variable?: string[]; // lista inicial de URIs - só UI\n    childrenItems?: any[]; // não usado\n    arrFuncs?: Array<(payload: any, args?: any) => any | Promise<any>>; // callbacks que recebem FILES/ASSETS\n    args?: any; // args repassados aos callbacks\n    onChange?: (uris: string[]) => void; // callback UI com as URIs\n    max?: number; // limite de itens\n  };\n};\n\nexport const BtnDocumentPicker = (props: Tprops) => {\n  const isWeb = RN.Platform.OS === \"web\";\n  return isWeb ? <BtnWeb {...props} /> : <BtnNat {...props} />;\n};\n\n/* ---------------- WEB ---------------- */\nconst BtnWeb = ({ pass }: Tprops) => {\n  const { variable = [], onChange, max, arrFuncs, args } = pass || {};\n  const inputRef = React.useRef<HTMLInputElement | null>(null);\n\n  // UI\n  const [docUris, setDocUris] = React.useState<string[]>(variable);\n  const [docNames, setDocNames] = React.useState<string[]>([]);\n  // Upload: Files reais\n  const [files, setFiles] = React.useState<File[]>([]);\n\n  // Dispara callbacks sempre que os FILES mudam\n  React.useEffect(() => {\n    if (arrFuncs) for (const fn of arrFuncs) fn(files, args);\n    // revoke das URLs quando componente desmontar\n    return () =>\n      docUris.forEach((u) => u.startsWith(\"blob:\") && URL.revokeObjectURL(u));\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [files]);\n\n  const pickWeb = () => inputRef.current?.click();\n\n  const handleWebFile = (event: React.ChangeEvent<HTMLInputElement>) => {\n    console.log(\"Document Picker - Web - Selected files\", event.target.files);\n    const fl = event.target.files;\n    if (!fl) return;\n\n    const newFiles = Array.from(fl);\n    // usamos blob URLs como \"preview\" (e também servem pra leitura upload, se quiser)\n    const newUris = newFiles.map((f) => URL.createObjectURL(f));\n    const newNames = newFiles.map((f) => f.name);\n\n    const nextUris = max\n      ? [...docUris, ...newUris].slice(0, max)\n      : [...docUris, ...newUris];\n    const nextFiles = max\n      ? [...files, ...newFiles].slice(0, max)\n      : [...files, ...newFiles];\n    const nextNames = max\n      ? [...docNames, ...newNames].slice(0, max)\n      : [...docNames, ...newNames];\n\n    setDocUris(nextUris);\n    setFiles(nextFiles);\n    setDocNames(nextNames);\n    onChange?.(nextUris);\n\n    // permitir re-selecionar os mesmos arquivos\n    event.target.value = \"\";\n  };\n\n  const removeAt = (idx: number) => {\n    const uris = [...docUris];\n    const fls = [...files];\n    const nms = [...docNames];\n\n    const [rm] = uris.splice(idx, 1);\n    fls.splice(idx, 1);\n    nms.splice(idx, 1);\n\n    if (rm?.startsWith(\"blob:\")) URL.revokeObjectURL(rm);\n\n    setDocUris(uris);\n    setFiles(fls);\n    setDocNames(nms);\n    onChange?.(uris);\n  };\n\n  return (\n    <>\n      <RN.View style={styles.container}>\n        <ThumbGrid images={docUris} names={docNames} onRemove={removeAt} />\n\n        <RN.Text style={styles.title}>Adicionar Documentos</RN.Text>\n        <RN.Text style={styles.subtitle}>\n          Selecione arquivos PDF, Word ou TXT\n        </RN.Text>\n        <RN.Pressable style={styles.btn} onPress={pickWeb}>\n          <RN.Text style={styles.btnTxt}>Adicionar</RN.Text>\n        </RN.Pressable>\n      </RN.View>\n\n      <input\n        ref={inputRef}\n        type=\"file\"\n        // Somente documentos\n        accept=\"application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,text/plain\"\n        multiple\n        style={{ display: \"none\" }}\n        onChange={handleWebFile}\n      />\n    </>\n  );\n};\n\n/* --------------- NATIVO --------------- */\nconst BtnNat = ({ pass }: Tprops) => {\n  const { variable = [], onChange, max, arrFuncs, args } = pass || {};\n\n  // UI: URIs e nomes\n  const [docUris, setDocUris] = React.useState<string[]>(variable);\n  const [docNames, setDocNames] = React.useState<string[]>([]);\n  // Upload: objetos do DocumentPicker\n  const [assets, setAssets] = React.useState<\n    Array<{ uri: string; name?: string; mimeType?: string; size?: number }>\n  >([]);\n\n  // Dispara callbacks sempre que os ASSETS mudam\n  React.useEffect(() => {\n    if (arrFuncs) for (const fn of arrFuncs) fn(assets, args);\n    return () => {\n      /* nada a revogar no nativo */\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [assets]);\n\n  const pickNative = async () => {\n    const result = await DocumentPicker.getDocumentAsync({\n      multiple: true,\n      type: [\n        \"application/pdf\",\n        \"application/msword\",\n        \"application/vnd.openxmlformats-officedocument.wordprocessingml.document\",\n        \"text/plain\",\n      ],\n      copyToCacheDirectory: true,\n    });\n\n    if (!result.canceled) {\n      const newUris = result.assets.map((a) => a.uri);\n      const newNames = result.assets.map((a) => a.name ?? \"Documento\");\n\n      const nextUris = max\n        ? [...docUris, ...newUris].slice(0, max)\n        : [...docUris, ...newUris];\n      const nextNames = max\n        ? [...docNames, ...newNames].slice(0, max)\n        : [...docNames, ...newNames];\n\n      const newAssets = result.assets.map((a) => ({\n        uri: a.uri,\n        name: a.name,\n        mimeType: a.mimeType,\n        size: a.size,\n      }));\n      const nextAssets = max\n        ? [...assets, ...newAssets].slice(0, max)\n        : [...assets, ...newAssets];\n\n      setDocUris(nextUris); // UI\n      setDocNames(nextNames); // nomes\n      setAssets(nextAssets); // Upload\n      onChange?.(nextUris);\n    }\n  };\n\n  const removeAt = (idx: number) => {\n    const uris = [...docUris];\n    const ats = [...assets];\n    const nms = [...docNames];\n\n    uris.splice(idx, 1);\n    ats.splice(idx, 1);\n    nms.splice(idx, 1);\n\n    setDocUris(uris);\n    setAssets(ats);\n    setDocNames(nms);\n    onChange?.(uris);\n  };\n\n  return (\n    <RN.View style={styles.container}>\n      <ThumbGrid images={docUris} names={docNames} onRemove={removeAt} />\n      <RN.Text style={styles.title}>Adicionar Documentos</RN.Text>\n      <RN.Text style={styles.subtitle}>\n        Selecione arquivos PDF, Word ou TXT\n      </RN.Text>\n      <RN.Pressable style={styles.btn} onPress={pickNative}>\n        <RN.Text style={styles.btnTxt}>Adicionar</RN.Text>\n      </RN.Pressable>\n    </RN.View>\n  );\n};\n\n/* ------- Grade de miniaturas reutilizável ------- */\nconst ThumbGrid = ({\n  images,\n  names,\n  onRemove,\n}: {\n  images: string[];\n  names?: string[];\n  onRemove: (idx: number) => void;\n}) => {\n  if (!images.length) return null;\n  return (\n    <RN.View style={thumb.grid}>\n      <RN.Text style={thumb.xTxt2}>Nome do Arquivo</RN.Text>\n      {images.map((uri, idx) => (\n        <RN.View key={uri + idx} style={thumb.item}>\n          {/* Nome do documento */}\n          <RN.View\n            style={{ flex: 1, alignItems: \"center\", justifyContent: \"center\" }}\n          >\n            <RN.Text\n              numberOfLines={2}\n              ellipsizeMode=\"tail\"\n              style={{ fontWeight: \"700\", fontSize: 12, textAlign: \"center\" }}\n            >\n              {names?.[idx] ?? \"Documento\"}\n            </RN.Text>\n          </RN.View>\n\n          {/* Botão remover */}\n          <RN.Pressable\n            hitSlop={8}\n            style={thumb.x}\n            onPress={() => onRemove(idx)}\n          >\n            <RN.Text style={thumb.xTxt}>×</RN.Text>\n          </RN.Pressable>\n        </RN.View>\n      ))}\n    </RN.View>\n  );\n};\n\n/* ---------------- STYLES ---------------- */\nconst styles = RN.StyleSheet.create({\n  container: {\n    width: \"100%\",\n    minHeight: 180,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    borderStyle: \"dashed\",\n    borderColor: \"#D5DBE3\",\n    borderRadius: 12,\n    borderWidth: 2,\n    padding: 20,\n    gap: 16,\n    backgroundColor: \"#fff\",\n  },\n  title: { fontSize: 18, fontWeight: \"700\", textAlign: \"center\" },\n  subtitle: { fontSize: 14, textAlign: \"center\", color: \"#4B5563\" },\n  btn: {\n    backgroundColor: \"#E8EDF5\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    borderRadius: 10,\n    height: 36,\n    paddingHorizontal: 16,\n  },\n  btnTxt: { fontSize: 14, fontWeight: \"700\" },\n});\n\nconst thumb = RN.StyleSheet.create({\n  grid: {\n    width: \"100%\",\n    flexDirection: \"row\",\n    flexWrap: \"wrap\",\n    justifyContent: \"center\",\n    columnGap: 10,\n    rowGap: 10,\n    borderWidth: 2,\n    borderColor: \"#E5E7EB\",\n    padding: 8,\n    marginBottom: 8,\n  },\n  item: {\n    position: \"relative\",\n    width: \"45%\",\n    aspectRatio: 1.6,\n    borderRadius: 6,\n    overflow: \"hidden\",\n  },\n  img: { width: \"100%\", height: \"100%\" },\n  x: {\n    position: \"absolute\",\n    top: 4,\n    right: 4,\n    width: 22,\n    height: 22,\n    borderRadius: 11,\n    backgroundColor: \"rgba(0,0,0,0.5)\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  xTxt: { color: \"#fff\", fontSize: 16, lineHeight: 16, fontWeight: \"700\" },\n  xTxt2: { fontSize: 14, lineHeight: 16 },\n});"}}