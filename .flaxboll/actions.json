{"1764256958446":{"actionType":"saveAll","createdAt":"1764256958446","actionID":"1764256958446","userID":"#TEMP","path":"system.capsules.cbebb8de-295b-4ddf-816b-5910b42d57de.capsUseCodeInfo.capsUseInputs.sss_custom_caps-0.capsIptTxtValue","oldValue":"async () => {\n  const css1 =\n    \"color: limegreen; background-color: darkcyan; font-size: 11px; padding: 2px 6px; border-radius: 3px\";\n\n  const { getFirestore, doc, updateDoc } = await import(\"firebase/firestore\");\n\n  const fbInit = tools.getCtData(\"all.temp.fireInit\");\n  const db = getFirestore(fbInit);\n\n  const stepId = tools.getCtData(\"sc.B9.forms.editChanges.stepId\");\n  console.log(\"%cstepId a atualizar:\", css1, { stepId });\n  const userId = tools.getCtData(\"sc.B9.currents.currId1\");\n  const data = tools.getCtData(\"sc.B9.forms.editChanges\");\n\n  try {\n    // ------ set Check Fields\n    // -----\n    // -----\n    // if(check1) return;\n\n    const refDoc = doc(db, \"users\", userId);\n    const newId = stepId.replace(\".\", \"_\"); // substitui pontos por underline\n\n    const dataToUpdate = {\n      [\"steps.\" + newId]: { ...data },\n    };\n\n    await updateDoc(refDoc, dataToUpdate);\n\n    // ------ set ctData\n    const pathSideRight = \"all.toggles.sideRight\";\n    const pathEdit = \"all.toggles.b9.editSteps\";\n    tools.setData({ path: \"sc.B9.forms.editChanges\", value: {} });\n    tools.setData({ path: pathSideRight, value: false });\n    tools.setData({ path: pathEdit, value: false });\n\n    console.log(\"%cupdateDoc ok\", css1);\n    console.log(\"%cReferência do Documento\", css1, {\n      path: \"users.\" + newId,\n      dataToUpdate,\n    });\n  } catch (err) {\n    console.error(\"Erro do updateDoc\", { err });\n  }\n}","newValue":"async () => {\n  const css1 =\n    \"color: limegreen; background-color: darkcyan; font-size: 11px; padding: 2px 6px; border-radius: 3px\";\n\n  const { getFirestore, doc, updateDoc } = await import(\"firebase/firestore\");\n\n  const fbInit = tools.getCtData(\"all.temp.fireInit\");\n  const db = getFirestore(fbInit);\n\n  const c8Data = tools.getCtData(\"sc.C8.profiles.profileData1\");\n\n  const lotId = tools.getCtData(\"sc.C7.currents.currLoteData\") || \"\";\n  const installmentId = c8Data.installmentId || \"\";\n\n  const documents = tools.getCtData(\"sc.C8.forms.editChanges.arrDocuments\");\n  const data = {\n    installmentId,\n    date: c8Data.date || \"\",\n    receiptUrl: documents[0] || \"\",\n  };\n\n  try {\n    const refDoc = doc(db, \"lots\", lotId);\n\n    const dataToUpdate = {\n      [\"receipts.\" + installmentId]: { ...data },\n    };\n\n    await updateDoc(refDoc, dataToUpdate);\n\n    // ------ set ctData\n    tools.setData({ path: \"sc.C8.forms.editChanges\", value: {} });\n    tools.setData({ path: \"sc.C8.profiles.profileData1\", value: {} });\n    \n    \n    console.log(\"%cupdateDoc ok\", css1);\n    console.log(\"%cReferência do Documento\", css1, {\n        path: \"lots.\" + installmentId,\n        dataToUpdate,\n    });\n\n    tools.goTo(\"c7financial\");\n  } catch (err) {\n    console.error(\"Erro do updateDoc C8\", { err });\n  }\n}"}}