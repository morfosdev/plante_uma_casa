{"1767123914561":{"actionType":"saveAll","createdAt":"1767123914561","actionID":"1767123914561","userID":"#TEMP","path":"system.capsules.eff57306-a96e-4bae-be56-15e20a03c471.capsUseCodeInfo.capsUseInputs.sss_custom_caps-0.capsIptTxtValue","oldValue":"async () => {\n  const css1 =\n    \"color: limegreen; background-color: darkcyan; font-size: 11px; padding: 2px 6px; border-radius: 3px\";\n\n  const { getFirestore, doc, updateDoc } = await import(\"firebase/firestore\");\n\n  const fbInit = tools.getCtData(\"all.temp.fireInit\");\n  const db = getFirestore(fbInit);\n\n  const stepId = tools.getCtData(\"sc.B9.forms.editChanges.stepId\");\n  console.log(\"%cstepId a atualizar:\", css1, { stepId });\n  const userId = tools.getCtData(\"sc.B9.currents.currId1\");\n  console.log(\"%cuserId a atualizar:\", css1, { userId });\n  const data = tools.getCtData(\"sc.B9.forms.editChanges\");\n  console.log(\"%cuserId a atualizar:\", css1, { data });\n\n  const condIdError = userId === \"\" || userId === undefined;\n  const pathErr = \"sc.B9.forms.error\";\n  const pathErrMsg = \"sc.B9.forms.errMsg\";\n\n  if (condIdError) {\n    console.error(\"userId inválido:\", { userId });\n\n    tools.setData({ path: pathErr, value: true });\n    tools.setData({\n      path: pathErrMsg,\n      value:\n        \"O proprietário do imóvel ainda não entrou no APP. Contate o Administrador.\",\n    });\n\n    return;\n  }\n\n  try {\n    // ------ set Check Fields\n    // -----\n    // -----\n    // if(check1) return;\n\n    const refDoc = doc(db, \"users\", userId);\n    const newId = stepId.replace(\".\", \"_\"); // substitui pontos por underline\n\n    const dataToUpdate = {\n      [\"steps.\" + newId]: { ...data },\n    };\n\n    await updateDoc(refDoc, dataToUpdate);\n\n    // ------ set ctData\n    const pathSideRight = \"all.toggles.sideRight\";\n    const pathEdit = \"all.toggles.b9.editSteps\";\n    tools.setData({ path: \"sc.B9.forms.editChanges\", value: {} });\n    tools.setData({ path: pathSideRight, value: false });\n    tools.setData({ path: pathEdit, value: false });\n\n    tools.setData({ path: pathErr, value: false });\n    tools.setData({ path: pathErrMsg, value: \"\" });\n\n    console.log(\"%cupdateDoc ok\", css1);\n    console.log(\"%cReferência do Documento\", css1, {\n      path: \"users.\" + newId,\n      dataToUpdate,\n    });\n  } catch (err) {\n    console.error(\"Erro do updateDoc\", { err });\n  }\n}","newValue":"async () => {\n  const css1 =\n    \"color: limegreen; background-color: darkcyan; font-size: 11px; padding: 2px 6px; border-radius: 3px\";\n\n  const { getFirestore, doc, updateDoc } = await import(\"firebase/firestore\");\n\n  const fbInit = tools.getCtData(\"all.temp.fireInit\");\n  const db = getFirestore(fbInit);\n\n  const stepId = tools.getCtData(\"sc.B9.forms.editChanges.stepId\");\n  console.log(\"%cstepId a atualizar:\", css1, { stepId });\n  const userId = tools.getCtData(\"sc.B9.currents.currId1\");\n  console.log(\"%cuserId a atualizar:\", css1, { userId });\n\n  const lotId = tools.getCtData(\"sc.B9.currents.currId2\");\n  console.log(\"%clotId a atualizar:\", css1, { lotId });\n\n  const data = tools.getCtData(\"sc.B9.forms.editChanges\");\n  console.log(\"%cuserId a atualizar:\", css1, { data });\n\n  const condIdError = userId === \"\" || userId === undefined;\n  const pathErr = \"sc.B9.forms.error\";\n  const pathErrMsg = \"sc.B9.forms.errMsg\";\n\n  if (condIdError) {\n    console.error(\"userId inválido:\", { userId });\n\n    tools.setData({ path: pathErr, value: true });\n    tools.setData({\n      path: pathErrMsg,\n      value:\n        \"O proprietário do imóvel ainda não entrou no APP. Contate o Administrador.\",\n    });\n\n    return;\n  }\n\n  try {\n    // ------ set Check Fields\n    // -----\n    // -----\n    // if(check1) return;\n    if (userId && userId !== \"\") {\n      const refDoc = doc(db, \"users\", userId);\n      const newId = stepId.replace(\".\", \"_\"); // substitui pontos por underline\n\n      const dataToUpdate = {\n        [\"steps.\" + newId]: { ...data },\n      };\n\n      await updateDoc(refDoc, dataToUpdate);\n    }\n\n    // ------ set Lot Notifications\n    if (lotId && lotId !== \"\") {\n      const refDocLot = doc(db, \"lots\", lotId);\n      const newId = stepId.replace(\".\", \"_\"); // substitui pontos por underline\n\n      const lotDataToUpdate = {\n        [\"steps.\" + newId]: { ...data },\n      };\n\n      await updateDoc(refDocLot, lotDataToUpdate);\n    }\n\n    // ------ set ctData\n    const pathSideRight = \"all.toggles.sideRight\";\n    const pathEdit = \"all.toggles.b9.editSteps\";\n    tools.setData({ path: \"sc.B9.forms.editChanges\", value: {} });\n    tools.setData({ path: pathSideRight, value: false });\n    tools.setData({ path: pathEdit, value: false });\n\n    tools.setData({ path: pathErr, value: false });\n    tools.setData({ path: pathErrMsg, value: \"\" });\n\n    console.log(\"%cupdateDoc ok\", css1);\n    console.log(\"%cReferência do Documento\", css1, {\n      path: \"users.\" + newId,\n      dataToUpdate,\n    });\n  } catch (err) {\n    console.error(\"Erro do updateDoc\", { err });\n  }\n}"}}