{"1764784358730":{"actionType":"saveAll","createdAt":"1764784358730","actionID":"1764784358730","userID":"#TEMP","path":"system.capsules.02bf0e4c-d34e-4219-89a4-6064dc82a8a8.capsUseCodeInfo.capsUseInputs.sss_custom_caps-0.capsIptTxtValue","oldValue":"(arg) => {\n  // --- valida arg ---\n  if (!arg) {\n    console.warn(\"onSelectStep: arg inválido\", arg);\n    return;\n  }\n\n  // --- encontra item clicado ---\n  const item =\n    typeof tools.findFlatItem === \"function\" ? tools.findFlatItem(arg) : null;\n\n  if (!item || typeof item !== \"object\") {\n    console.warn(\"onSelectStep: item não encontrado ou inválido\", item);\n    return;\n  }\n\n  const stepId = item.stepId;\n\n  if (stepId == null) {\n    console.warn(\"onSelectStep: stepId ausente no item\", item);\n    return;\n  }\n\n  // --- pega lista de steps do estado ---\n  let arrStepsDB = tools.getCtData(\"sc.C5.lists.list1\");\n  let arrStepsStatic = tools.getCtData(\"sc.B7.statics.steps\");\n  console.log(\"onSelectStep arrStepsDB cru\", { arrStepsDB });\n\n  if (!arrStepsDB) {\n    console.warn(\"onSelectStep: arrStepsDB indefinido/vazio\");\n    return;\n  }\n\n  // garante array (caso venha como objeto)\n  if (!Array.isArray(arrStepsDB)) {\n    arrStepsDB = Object.values(arrStepsDB);\n  }\n\n  // --- encontra o step selecionado ---\n  const selectStep = arrStepsDB.find((i) => i && i.stepId === stepId);\n\n  // NOVA VERIFICAÇÃO: impede navegação se qualquer campo estiver faltando\n  const requiredFields = [\"date\", \"responsible\", \"description\"];\n  const missing = requiredFields.filter((f) => !selectStep?.[f]);\n\n  if (missing.length > 0) {\n    console.warn(\"Step incompleto, falta:\", missing);\n    return;\n  }\n\n  // --- busca labels estáticos ---\n  function findStepById(arr, stepId) {\n    if (!Array.isArray(arr) || !stepId) return null;\n\n    for (const group of arr) {\n      if (!group?.subs) continue;\n\n      const found = group.subs.find((s) => s.stepId === stepId);\n      if (found) return { stepLabel: group.label, subStepLabel: found.label };\n    }\n\n    return null;\n  }\n  const selectStepStatic = findStepById(arrStepsStatic, stepId);\n  console.log(\"onSelectStep selectStepStatic\", {\n    selectStepStatic,\n    arrStepsStatic,\n  });\n\n  // Set CtData\n  tools.setData({\n    path: \"sc.C6.forms.editChanges.stepLabel\",\n    value: selectStepStatic?.stepLabel ?? \"\",\n  });\n\n  tools.setData({\n    path: \"sc.C6.forms.editChanges.subStepLabel\",\n    value: selectStepStatic?.subStepLabel ?? \"\",\n  });\n\n  tools.setData({\n    path: \"sc.C6.forms.editChanges.date\",\n    value: selectStep?.date ?? \"\",\n  });\n\n  tools.setData({\n    path: \"sc.C6.forms.editChanges.responsible\",\n    value: selectStep?.responsible ?? \"\",\n  });\n\n  tools.setData({\n    path: \"sc.C6.forms.editChanges.description\",\n    value: selectStep?.description ?? \"\",\n  });\n\n  tools.setData({\n    path: \"sc.C6.forms.editChanges.arrImages\",\n    value: selectStep?.arrImages ?? \"\",\n  });\n\n  tools.setData({\n    path: \"sc.C6.forms.editChanges.arrDocuments\",\n    value: selectStep?.arrDocuments ?? \"\",\n  });\n\n  tools.goTo(\"c6stepProfile\");\n}\n","newValue":"(arg) => {\n  // --- valida arg ---\n  if (!arg) {\n    console.warn(\"onSelectStep: arg inválido\", arg);\n    return;\n  }\n\n  // --- encontra item clicado ---\n  const item =\n    typeof tools.findFlatItem === \"function\" ? tools.findFlatItem(arg) : null;\n\n  if (!item || typeof item !== \"object\") {\n    console.warn(\"onSelectStep: item não encontrado ou inválido\", item);\n    return;\n  }\n\n  const stepId = item.stepId;\n\n  if (stepId == null) {\n    console.warn(\"onSelectStep: stepId ausente no item\", item);\n    return;\n  }\n\n  // --- pega lista de steps do estado ---\n  let arrStepsDB = tools.getCtData(\"sc.C5.lists.list1\");\n  let arrStepsStatic = tools.getCtData(\"sc.B7.statics.steps\");\n  console.log(\"onSelectStep arrStepsDB cru\", { arrStepsDB });\n\n  if (!arrStepsDB) {\n    console.warn(\"onSelectStep: arrStepsDB indefinido/vazio\");\n    return;\n  }\n\n  // garante array (caso venha como objeto)\n  if (!Array.isArray(arrStepsDB)) {\n    arrStepsDB = Object.values(arrStepsDB);\n  }\n\n  // --- encontra o step selecionado ---\n  const selectStep = arrStepsDB.find((i) => i && i.stepId === stepId);\n\n  // NOVA VERIFICAÇÃO: impede navegação se qualquer campo estiver faltando\n  const requiredFields = [\"date\", \"responsible\", \"description\"];\n  const missing = requiredFields.filter((f) => !selectStep?.[f]);\n\n  if (missing.length > 0) {\n    console.warn(\"Step incompleto, falta:\", missing);\n    return;\n  }\n\n  // --- busca labels estáticos ---\n  function findStepById(arr, stepId) {\n    if (!Array.isArray(arr) || !stepId) return null;\n\n    for (const group of arr) {\n      if (!group?.subs) continue;\n\n      const found = group.subs.find((s) => s.stepId === stepId);\n      if (found) return { stepLabel: group.label, subStepLabel: found.label };\n    }\n\n    return null;\n  }\n  const selectStepStatic = findStepById(arrStepsStatic, stepId);\n  console.log(\"onSelectStep selectStepStatic\", {\n    selectStepStatic,\n    arrStepsStatic,\n  });\n\n  // Set CtData\n  tools.setData({\n    path: \"sc.C6.forms.editChanges.stepLabel\",\n    value: selectStepStatic?.stepLabel ?? \"\",\n  });\n\n  tools.setData({\n    path: \"sc.C6.forms.editChanges.subStepLabel\",\n    value: selectStepStatic?.subStepLabel ?? \"\",\n  });\n\n  tools.setData({\n    path: \"sc.C6.forms.editChanges.date\",\n    value: selectStep?.date ?? \"\",\n  });\n\n  tools.setData({\n    path: \"sc.C6.forms.editChanges.responsible\",\n    value: selectStep?.responsible ?? \"\",\n  });\n\n  tools.setData({\n    path: \"sc.C6.forms.editChanges.description\",\n    value: selectStep?.description ?? \"\",\n  });\n\n  tools.setData({\n    path: \"sc.C6.forms.editChanges.arrImages\",\n    value: selectStep?.arrImages ?? \"\",\n  });\n\n  tools.setData({\n    path: \"sc.C6.forms.editChanges.arrDocuments\",\n    value: selectStep?.arrDocuments ?? \"\",\n  });\n\n  tools.goTo(\"c6stepProfile\");\n}"}}